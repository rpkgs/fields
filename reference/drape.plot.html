<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Perspective plot draped with colors in the facets. — drape.plot • fields</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Perspective plot draped with colors in the facets. — drape.plot"><meta property="og:description" content="Function to produce the 
usual wireframe perspective plot with the facets being filled  
with different colors. By default the colors are assigned from a
color bar based on the z values. drape.color  can be used to create
a color matrix different from the z matrix used for the wireframe."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fields</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">14.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Tps.html">Tps usage illustration</a>
    </li>
    <li>
      <a href="../articles/fastTps.html">fastTps</a>
    </li>
    <li>
      <a href="../articles/predictSurface.html">predictSurface</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/dnychka/fieldsRPackage/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Perspective plot draped with colors in the facets.</h1>
    
    <div class="hidden name"><code>drape.plot.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Function to produce the 
usual wireframe perspective plot with the facets being filled  
with different colors. By default the colors are assigned from a
color bar based on the z values. <code>drape.color</code>  can be used to create
a color matrix different from the z matrix used for the wireframe.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">drape.plot</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">z</span>, z2<span class="op">=</span><span class="cn">NULL</span>, col <span class="op">=</span> <span class="fu"><a href="tim.colors.html">tim.colors</a></span><span class="op">(</span><span class="fl">64</span><span class="op">)</span>, zlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">z</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, </span>
<span> zlim2 <span class="op">=</span> <span class="cn">NULL</span>, add.legend <span class="op">=</span> <span class="cn">TRUE</span>, horizontal <span class="op">=</span> <span class="cn">TRUE</span>, theta <span class="op">=</span> <span class="fl">30</span>, phi <span class="op">=</span> <span class="fl">20</span>, </span>
<span>   breaks<span class="op">=</span><span class="cn">NA</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">drape.color</span><span class="op">(</span><span class="va">z</span>, col <span class="op">=</span> <span class="fu"><a href="tim.colors.html">tim.colors</a></span><span class="op">(</span><span class="fl">64</span><span class="op">)</span>, zlim <span class="op">=</span> <span class="cn">NULL</span>,<span class="va">breaks</span>,</span>
<span>   transparent.color <span class="op">=</span> <span class="st">"white"</span>, midpoint<span class="op">=</span><span class="cn">TRUE</span>, eps<span class="op">=</span><span class="fl">1e-8</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>grid values for x coordinate (or if x is a list the 
components x y and z are used.)</p></dd>

  <dt>y</dt>
<dd><p>grid values for y coordinate</p></dd>

  <dt>z</dt>
<dd><p>A matrix of z heights</p></dd>

  <dt>z2</dt>
<dd><p>A matrix of z values to use for coloring facets. If NULL 
then z is used for this purpose</p></dd>

  <dt>col</dt>
<dd><p>A color table for the z values that will be used for draping</p></dd>

  <dt>zlim</dt>
<dd><p>the z limits for <code>z</code> these are used to set up
  the scale of the persp plot. This defaults to range(z, na.rm=TRUE) as
  in persp</p></dd>

  <dt>zlim2</dt>
<dd><p>the z limits for <code>z2</code> these are used to set up
  the color scale. This defaults to</p></dd>

  <dt>add.legend</dt>
<dd><p>If true a color strip is added as a legend.</p></dd>

  <dt>horizontal</dt>
<dd><p>If true color strip is put at bottom of the 
plot, if FALSE it is placed vertically on the right side.</p></dd>

  <dt>theta</dt>
<dd><p>x-y rotation angle for perspective.</p></dd>

  <dt>phi</dt>
<dd><p>z-angle for perspective.</p></dd>

  <dt>transparent.color</dt>
<dd><p>Color to use when given an NA in z</p></dd>
 
  <dt>midpoint</dt>
<dd><p>If TRUE color scale is formed for midpoints of z
       obtained by averaging 4 corners.</p></dd>

  <dt>breaks</dt>
<dd><p>Numerical divisions for the color scale. If the default (NA)
  is N+1 equally spaced points in the range <code>zlim</code> where N is the number of
colors in <code>col</code>. This is the argument has the same effect as used in the
<code>image</code> and <code>image.plot</code> functions.</p></dd>

 <dt>eps</dt>
<dd><p>Amount to inflate the range (1+/- eps) to inlude points on 
     break endpoints.</p></dd>

  <dt>...</dt>
<dd><p>Other arguments that will be passed to the 
          persp function. The most common is zlim the z limits for the
	  3-d  plot and also the limits to set up the color scale. The
	  default for zlim is the range of z.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>drape.plot</code></p>


<p>If an assignment is made the projection matrix from persp is returned. 
This information can be used to add additional 3-d features to the plot.
See the <code>persp</code> help file for an example how to add additional points 
and lines using the <code>trans3d</code> function and also the example below.</p>



<p><code>drape.color</code> If dim( z) = M,N this function returns a list with components:</p>
<dl><dt>color.index</dt>
<dd><p>An (M-1)X(N-1) matrix (midpoint= TRUE) or MXN matrx (midpoint=FALSE) where each element is a text string specifying the color.</p></dd>

<dt>breaks</dt>
<dd><p>The breaks used to assign the numerical values in z to color categories.</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
     

<p>The legend strip may obscure part of the plot. If so, add this as
another step using image.plot.</p>
<p>When using <code>drape.color</code> just drop the results into the
<code>col</code> argument of <code>persp</code>. Given this function there are no
surprises how the higher level <code>drape.plot</code> works: it calls
<code>drape.color</code> followed by <code>persp</code> and finally the legend
strip is added with <code>image.plot</code>.</p>
<p>The color scales essentially default to the ranges of the z
values. However, by specifying zlim and/or zlim2 one has more control
of how the perspective plot is scaled and the limits of the color
scale used to fill the facets.  The color assignments are done by
dividing up the zlim2 interval into equally spaced bins and adding a
very small inflation to these limits.  The mean z2 values, comprising
an (M-1)X(N-1) matrix, for each facet are discretized to the bins. The
bin numbers then become the indices used for the color scale. If zlim2
is not specified it is the range of the z2 matrix is used to generate
the ranges of the color bar. Note that this may be different than the
range of the mean facets.  If z2 is not passed then z is used in its
place and in this case the zlim2 or zlim argument can used to define
the color scale.</p>
<p>This kind of plot is also supported through the wireframe function in the
<code>lattice</code> package. The advantage of the fields version is that it uses the
standard R graphics functions -- and is written in R code.</p>
<p>The drape plot is also drawn by the fields <code>surface</code> function with 
<code>type="P"</code>.</p>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>D. Nychka</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>image.plot, quilt.plot,  persp, plot.surface, surface, lattice, trans3d</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># an obvious choice:</span></span></span>
<span class="r-in"><span><span class="co"># Dr. R's favorite New Zealand Volcano!</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span> <span class="va">volcano</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">M</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span> <span class="va">volcano</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">N</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span> <span class="va">volcano</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span> <span class="fl">0</span>,<span class="fl">1</span>,,<span class="va">M</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span> <span class="fl">0</span>,<span class="fl">1</span>,,<span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">pm</span><span class="op">&lt;-</span> <span class="fu">drape.plot</span><span class="op">(</span> <span class="va">x</span>,<span class="va">y</span>,<span class="va">volcano</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span><span class="fl">128</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-plt img"><img src="drape.plot-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use different range for color scale and persp plot</span></span></span>
<span class="r-in"><span><span class="co"># setting of border omits the mesh lines</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="fu">drape.plot</span><span class="op">(</span> <span class="va">x</span>,<span class="va">y</span>,<span class="va">volcano</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">topo.colors</a></span><span class="op">(</span><span class="fl">128</span><span class="op">)</span>,zlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">300</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                     zlim2<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="fl">120</span>,<span class="fl">200</span><span class="op">)</span>, border<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># note tranparent color for facets outside the zlim2 range</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#The projection has been saved in pm</span></span></span>
<span class="r-in"><span><span class="co"># add a point marking the summit</span></span></span>
<span class="r-in"><span><span class="va">zsummit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span> <span class="va">volcano</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">ix</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/row.html" class="external-link">row</a></span><span class="op">(</span> <span class="va">volcano</span><span class="op">)</span><span class="op">[</span><span class="va">volcano</span><span class="op">==</span><span class="va">zsummit</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">iy</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/col.html" class="external-link">col</a></span><span class="op">(</span> <span class="va">volcano</span><span class="op">)</span><span class="op">[</span><span class="va">volcano</span><span class="op">==</span><span class="va">zsummit</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">uv</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/trans3d.html" class="external-link">trans3d</a></span><span class="op">(</span> <span class="va">x</span><span class="op">[</span><span class="va">ix</span><span class="op">]</span>, <span class="va">y</span><span class="op">[</span><span class="va">iy</span><span class="op">]</span>,<span class="va">zsummit</span>,<span class="va">pm</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span> <span class="va">uv</span>, col<span class="op">=</span><span class="st">"magenta"</span>, pch<span class="op">=</span><span class="st">"+"</span>, cex<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="drape.plot-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># overlay volcano wireframe with gradient in x direction. </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">dz</span><span class="op">&lt;-</span> <span class="op">(</span> </span></span>
<span class="r-in"><span>     <span class="va">volcano</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">M</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">N</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">-</span> <span class="va">volcano</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">M</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">N</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span> <span class="op">+</span></span></span>
<span class="r-in"><span>     <span class="va">volcano</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">M</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">]</span> <span class="op">-</span> <span class="va">volcano</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">M</span><span class="op">)</span>, <span class="fl">2</span><span class="op">:</span><span class="op">(</span><span class="va">N</span><span class="op">)</span><span class="op">]</span>  </span></span>
<span class="r-in"><span>         <span class="op">)</span><span class="op">/</span><span class="fl">2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># convert dz to a color scale:</span></span></span>
<span class="r-in"><span>  <span class="va">zlim</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> <span class="va">dz</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">zcol</span><span class="op">&lt;-</span><span class="fu">drape.color</span><span class="op">(</span> <span class="va">dz</span>, zlim <span class="op">=</span><span class="va">zlim</span>, col <span class="op">=</span> <span class="fu">viridis</span><span class="op">(</span><span class="fl">64</span><span class="op">)</span> <span class="op">)</span><span class="op">$</span><span class="va">color.index</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># with these colors </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/persp.html" class="external-link">persp</a></span><span class="op">(</span> <span class="va">volcano</span>, col<span class="op">=</span><span class="va">zcol</span>, theta<span class="op">=</span><span class="fl">30</span>, phi<span class="op">=</span><span class="fl">20</span>,</span></span>
<span class="r-in"><span>  border<span class="op">=</span><span class="cn">NA</span>,expand<span class="op">=</span><span class="fl">.3</span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># add legend using image.plot function </span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="image.plot.html">image.plot</a></span><span class="op">(</span> zlim<span class="op">=</span><span class="va">zlim</span>, legend.only <span class="op">=</span><span class="cn">TRUE</span>, horizontal <span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>            col<span class="op">=</span> <span class="fu">viridis</span><span class="op">(</span><span class="fl">64</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="drape.plot-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span> </span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Douglas Nychka, Reinhard Furrer, John Paige, Stephan Sain, Florian Gerber, Matthew Iverson.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

