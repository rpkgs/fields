<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Cubic smoothing spline regression — sreg • fields</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Cubic smoothing spline regression — sreg"><meta property="og:description" content="Fits a cubic smoothing spline to univariate data. The amount of
smoothness can be specified or estimated from the data by GCV. 
&amp;lt;!--brief description--&amp;gt;"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fields</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">14.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Tps.html">Tps usage illustration</a>
    </li>
    <li>
      <a href="../articles/fastTps.html">fastTps</a>
    </li>
    <li>
      <a href="../articles/predictSurface.html">predictSurface</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/dnychka/fieldsRPackage/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Cubic smoothing spline regression</h1>
    
    <div class="hidden name"><code>sreg.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Fits a cubic smoothing spline to univariate data. The amount of
smoothness can be specified or estimated from the data by GCV. 
&lt;!--brief description--&gt;</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">sreg</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, lambda <span class="op">=</span> <span class="cn">NA</span>, df <span class="op">=</span> <span class="cn">NA</span>, offset <span class="op">=</span> <span class="fl">0</span>, weights <span class="op">=</span></span>
<span>                 <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>, cost <span class="op">=</span> <span class="fl">1</span>, nstep.cv <span class="op">=</span> <span class="fl">80</span>, tol <span class="op">=</span></span>
<span>                 <span class="fl">1e-05</span>, find.diagA <span class="op">=</span> <span class="cn">TRUE</span>, trmin <span class="op">=</span> <span class="fl">2.01</span>, trmax <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                 lammin <span class="op">=</span> <span class="cn">NA</span>, lammax <span class="op">=</span> <span class="cn">NA</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, do.cv <span class="op">=</span></span>
<span>                 <span class="cn">TRUE</span>, method <span class="op">=</span> <span class="st">"GCV"</span>, rmse <span class="op">=</span> <span class="cn">NA</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, digits</span>
<span>                 <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># S3 method for sreg</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">x</span>, derivative <span class="op">=</span> <span class="fl">0</span>, model <span class="op">=</span> <span class="fl">1</span>,<span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>Vector of x value</p></dd>


<dt>y</dt>
<dd><p>Vector of y values</p></dd>


<dt>lambda</dt>
<dd><p>Single smoothing parameter or a vector of values . If omitted 
smoothing parameter estimated by GCV. NOTE: lam here is equivalent to 
the value lambda*N  in Tps/Krig  where N is the number of unique observations.
See example below.</p></dd>


<dt>object</dt>
<dd><p>An sreg object.</p></dd>

<dt>derivative</dt>
<dd><p>Order of deriviatve to evaluate. Must be 0,1, or 2.</p></dd>

<dt>df</dt>
<dd><p>Amount of smoothing in term of effective degrees of freedom for the
spline</p></dd>


<dt>offset</dt>
<dd><p>an offset added to the term cost*degrees of freedom in the denominator of
the GCV function. (This would be used for adjusting the df from fitting
other models such as in back-fitting additive models.)</p></dd>


<dt>model</dt>
<dd><p>Specifies which model parameters to use.</p></dd>


<dt>weights</dt>
<dd><p>A vector that is proportional to the reciprocal variances of the
errors.</p></dd>


<dt>cost</dt>
<dd><p>Cost value to be used in the GCV criterion.</p></dd>


<dt>nstep.cv </dt>
<dd><p>Number of grid points of smoothing parameter for GCV grid search.</p></dd>


<dt>tol</dt>
<dd><p>Tolerance for convergence in minimizing the GCV or other
criteria to estimate the smoothing parameter.</p></dd>

<dt>find.diagA</dt>
<dd><p>If TRUE  calculates the diagonal elements of the smoothing matrix. The
effective
number of degrees of freedom is the sum of these diagonal elements.
Default is true. This requires more stores if a grid of smoothing
parameters is passed. ( See returned values below.)</p></dd>


<dt>trmin</dt>
<dd><p>Sets the minimum of the smoothing parameter range  for the GCV grid
search in terms of effective degrees of freedom.</p></dd>


<dt>trmax</dt>
<dd><p>Sets the maximum of the smoothing parameter range  for the GCV grid
search in terms of effective degrees of freedom. If NA the range is set
to .99 of number of unique locations.</p></dd>


<dt>lammin</dt>
<dd><p>Same function as trmin but in the lambda scale.</p></dd>


<dt>lammax</dt>
<dd><p>Same function as trmax but in the lambda scale.</p></dd>


<dt>verbose</dt>
<dd><p>Print out all sorts of debugging info. Default is falseof course!</p></dd>


<dt>do.cv</dt>
<dd><p>Evaluate the spline at the GCV minimum. Default is true.</p></dd>


<dt>method</dt>
<dd><p>A character string giving the 
method for determining the smoothing
parameter. Choices are
"GCV", "GCV.one", "GCV.model", "pure error", "RMSE". Default is "GCV".</p></dd>


<dt>rmse</dt>
<dd><p>Value of the root mean square error to match by varying lambda.</p></dd>


<dt>na.rm</dt>
<dd><p>If TRUE NA's are removed from y before analysis.</p></dd>


<dt>digits</dt>
<dd><p>Number of significant digits used to determine replicate x values.</p></dd>


<dt>...</dt>
<dd><p>Other optional arguments to pass to the predict function.</p></dd>


</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>Returns a list of class sreg. 
Some of the returned components are</p>
<dl><dt>call</dt>
<dd><p>Call to the function</p></dd>

<dt>yM</dt>
<dd><p>Vector of dependent variables. If replicated data is given these are the
replicate group means.</p></dd>


<dt>xM</dt>
<dd><p>Unique x values matching the y's.</p></dd>

<dt>weights</dt>
<dd><p>Proportional to reciprocal variance of each data point.</p></dd>

<dt>weightsM</dt>
<dd><p>Proportional to reciprocal pooled variance of each 
replicated mean data value (xM).</p></dd>


<dt>x</dt>
<dd><p>Original x data.</p></dd>


<dt>y</dt>
<dd><p>Original y data.</p></dd>


<dt>method</dt>
<dd><p>Method used to find the smoothing parameter.</p></dd>


<dt>pure.ss</dt>
<dd><p>Pure error sum of squares from replicate groups.</p></dd>


<dt>tauHat.pure.error</dt>
<dd><p>Estimate of tau from replicate groups.</p></dd>


<dt>tauHat.GCV</dt>
<dd><p>Estimate of tau using estimated lambda from GCV minimization</p></dd>


<dt>trace</dt>
<dd><p>Effective degrees of freedom for the spline estimate(s)</p></dd>


<dt>gcv.grid</dt>
<dd><p>Values of trace, GCV, tauHat. etc. for a grid of smoothing parameters.
If lambda ( or df) is specified those values are used.</p></dd>


<dt>lambda.est</dt>
<dd><p>Summary of various estimates of the smoothing parameter</p></dd>


<dt>lambda</dt>
<dd><p>If lambda is specified the passed  vector, if missing the estimated value.</p></dd>


<dt>residuals</dt>
<dd><p>Residuals from spline(s). If lambda or df is specified the residuals from
these values. If lambda and df are omitted then the spline having
estimated lambda. This will be a matrix with as many columns as the values
of lambda.</p></dd>


<dt>fitted.values</dt>
<dd><p>Matrix of fitted values. See notes on residuals.</p></dd>


<dt>predicted</dt>
<dd><p>A list with components  x and y. x is the unique values of xraw in sorted
order. y is a matrix of the spline estimates at these values.</p></dd>


<dt>eff.df</dt>
<dd><p>Same as trace.</p></dd>


<dt>diagA</dt>
<dd><p>Matrix containing diagonal elements of the smoothing matrix. Number of
columns is the number of lambda values. 
WARNING: If there is replicated data the
diagonal elements are those for the smoothing the group means at the
unique x locations.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>MODEL: The assumed model is Y.k=f(x.k) +e.k where e.k should be
approximately
normal and independent errors with variances tau**2/w.k</p>
<p>ESTIMATE: A smoothing spline is a locally weighted average of the y's
based 
on the relative locations of the x values. Formally the estimate is 
the curve that minimizes the criterion:</p>
    
<p>(1/n) sum(k=1,n) w.k( Y.k - f( X.k))**2  + lambda R(f)</p>
<p>where R(f) is the integral of the squared second derivative of f over 
the range of the X values. Because of the inclusion of the (1/n) in the
sum of squares the lambda parameter in sreg corresponds to the a value of
lambda*n in the Tps function and in the Krig function.</p> 
<p>The solution to this minimization is a piecewise cubic polynomial with
the join points at the unique set of X values. The polynomial segments
are constructed so that the entire curve has continuous first and second
derivatives and the second and third derivatives are zero at the
boundaries.  The smoothing has the range [0,infinity]. Lambda equal to
zero gives a cubic spline interpolation of the data. As lambda diverges
to infinity ( e.g lambda =1e20) the estimate will converge to the
straight line estimated by least squares.</p>
<p>The values of the estimated function at the data points can be
expressed in the matrix form:</p>  
<p>predicted values= A(lambda)Y</p>
<p>where A is an nXn symmetric matrix that does NOT depend on Y. 
The diagonal elements are the leverage values for the estimate and the 
sum of these  (trace(A(lambda)) can be interpreted as the effective 
number of parameters that are used to define the spline function. 
IF there are replicate points the A matrix is the result of finding group
averages and applying a weighted spline to the means. 
The A matrix is also used to find "Bayesian" confidence intervals for the 
estimate, see the example below.</p>
<p>CROSS-VALIDATION:The GCV criterion with no replicate points for a fixed
value of lambda is</p>
<p>(1/n)(Residual sum of squares)/((1-(tr(A)-offset)*cost + offset)/n)**2,</p>
<p>Usually offset =0 and cost =1. Variations on GCV with replicate points are
described in the documentation help file for Krig.  With an appropriate
choice for the smoothing parameter, the estimate of tau**2 is found by
(Residual sum of squares)/tr(A).</p>
<p>COMPUTATIONS: The computations for 1-d splines exploit the banded
structure of the matrices needed to solve for the spline coefficients.
Banded structure also makes it possible to get the diagonal elements of A
quickly. This approach is different from the algorithms in Tps and
tremendously more efficient for larger numbers of unique x values ( say &gt;
200). The advantage of Tps is getting "Bayesian" standard errors at
predictions different from the observed x values. This function is similar
to the S-Plus smooth.spline. The main advantages are more information and
control over the choice of lambda and also the FORTRAN source code is
available (css.f).</p>
<p>See also the function <code>splint</code> which is designed to be a bare bones
but fast smoothing spline.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Krig, Tps, splint</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># fit a GCV spline to  </span></span></span>
<span class="r-in"><span><span class="co"># control group of rats.  </span></span></span>
<span class="r-in"><span><span class="va">fit</span><span class="op">&lt;-</span> <span class="fu">sreg</span><span class="op">(</span><span class="va">rat.diet</span><span class="op">$</span><span class="va">t</span>,<span class="va">rat.diet</span><span class="op">$</span><span class="va">con</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span> <span class="va">fit</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CALL:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> sreg(x = rat.diet$t, y = rat.diet$con)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of Observations:             39   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of unique points:            39   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Eff. degrees of freedom for spline: 7.6  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Residual degrees of freedom:        31.4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  GCV est. tau                        1.581</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  lambda                              10.42</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RESIDUAL SUMMARY:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      min    1st Q   median    3rd Q      max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -4.53200 -0.46270 -0.07006  0.61350  3.55300 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DETAILS ON SMOOTHING PARAMETER:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Method used:      Cost: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    lambda       trA       GCV   GCV.one GCV.model    tauHat </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    10.423     7.550     3.098     3.098        NA     1.581 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Summary of estimates for lambda</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         lambda  trA   GCV tauHat converge</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GCV      10.42 7.55 3.098  1.581        4</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GCV.one  10.42 7.55 3.098  1.581        4</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="set.panel.html">set.panel</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> plot window will lay out plots in a 2 by 2 matrix </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>                       <span class="co"># four diagnostic plots of  fit </span></span></span>
<span class="r-plt img"><img src="sreg-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="set.panel.html">set.panel</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> plot window will lay out plots in a 1 by 1 matrix </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span> <span class="va">fit</span><span class="op">)</span> <span class="co"># predicted values at data points </span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1] 19.84457 19.86637 19.91489 20.10735 20.20748 20.49242 21.43099 21.75381</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9] 22.47953 24.00058 24.34566 24.94673 25.81778 25.99919 26.34511 26.95274</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17] 27.08416 27.31120 27.58160 27.61676 27.66454 27.76603 27.79317 27.84516</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [25] 27.93358 27.95091 27.96834 27.90773 27.88407 27.78388 27.78546 27.82238</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [33] 27.85489 27.90905 27.96906 28.04095 28.05798 28.02834 27.82057</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">xg</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">110</span>,,<span class="fl">50</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">sm</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span> <span class="va">fit</span>, <span class="va">xg</span><span class="op">)</span> <span class="co"># spline fit at 50 equally spaced points </span></span></span>
<span class="r-in"><span><span class="va">der.sm</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span> <span class="va">fit</span>, <span class="va">xg</span>, deriv<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="co"># derivative of spline fit </span></span></span>
<span class="r-in"><span><span class="fu"><a href="set.panel.html">set.panel</a></span><span class="op">(</span> <span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span> </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> plot window will lay out plots in a 2 by 1 matrix </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">fit</span><span class="op">$</span><span class="va">x</span>, <span class="va">fit</span><span class="op">$</span><span class="va">y</span><span class="op">)</span> <span class="co"># the data </span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span> <span class="va">xg</span>, <span class="va">sm</span><span class="op">)</span> <span class="co"># the spline </span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">xg</span>,<span class="va">der.sm</span>, type<span class="op">=</span><span class="st">"l"</span><span class="op">)</span> <span class="co"># plot of estimated derivative </span></span></span>
<span class="r-plt img"><img src="sreg-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="fu"><a href="set.panel.html">set.panel</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># reset panel to 1 plot</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> plot window will lay out plots in a 1 by 1 matrix </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># the same fit using  the thin plate spline numerical algorithms </span></span></span>
<span class="r-in"><span><span class="co"># sreg does not scale the obs so instruct Tps not to sacel either</span></span></span>
<span class="r-in"><span><span class="co"># this will make lambda comparable within factor of n. </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="va">fit.tps</span><span class="op">&lt;-</span><span class="fu"><a href="Tps.html">Tps</a></span><span class="op">(</span> <span class="va">rat.diet</span><span class="op">$</span><span class="va">t</span>,<span class="va">rat.diet</span><span class="op">$</span><span class="va">con</span>, scale<span class="op">=</span><span class="st">"unscaled"</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span> <span class="va">fit.tps</span><span class="op">)</span> </span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CALL:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Tps(x = rat.diet$t, Y = rat.diet$con, scale.type = "unscaled")</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of Observations:                39      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of unique points:               39      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of parameters in the null space 2       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Parameters for fixed spatial drift     2       </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Effective degrees of freedom:          7.6     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Residual degrees of freedom:           31.4    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  MLE tau                                1.482   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  GCV tau                                1.58    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  MLE sigma                              0.005488</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Scale passed for covariance (sigma)    &lt;NA&gt;    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Scale passed for nugget (tau^2)        &lt;NA&gt;    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Smoothing parameter lambda             400.4   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual Summary:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      min    1st Q   median    3rd Q      max </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> -4.52600 -0.46540 -0.07029  0.61010  3.54900 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Covariance Model: Rad.cov</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Names of non-default covariance arguments: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        p</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> DETAILS ON SMOOTHING PARAMETER:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Method used:   GCV    Cost:  1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    lambda       trA       GCV   GCV.one GCV.model    tauHat </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   400.400     7.575     3.098     3.098        NA     1.580 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Summary of all estimates found for lambda</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            lambda   trA   GCV tauHat -lnLike Prof converge</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GCV         400.4 7.575 3.098  1.580        75.54        1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GCV.model      NA    NA    NA     NA           NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> GCV.one     400.4 7.575 3.098  1.580           NA        1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> RMSE           NA    NA    NA     NA           NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> pure error     NA    NA    NA     NA           NA       NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> REML       3950.0 4.714 3.110  1.654        74.02        6</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compare sreg and Tps results to show the adjustment to lambda.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span> <span class="va">fit</span><span class="op">)</span><span class="op">-&gt;</span> <span class="va">look</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span> <span class="va">fit.tps</span>, lambda<span class="op">=</span><span class="va">fit</span><span class="op">$</span><span class="va">lambda</span><span class="op">*</span><span class="va">fit</span><span class="op">$</span><span class="va">N</span><span class="op">)</span><span class="op">-&gt;</span> <span class="va">look2</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="fields.tests.html">test.for.zero</a></span><span class="op">(</span> <span class="va">look</span>, <span class="va">look2</span><span class="op">)</span> <span class="co"># silence means it checks to 1e-8</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PASSED test at tolerance  1e-08</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># finding approximate standard errors at observations</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">SE</span><span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">tauHat.GCV</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">diagA</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compare to predictSE( fit.tps) differences are due to </span></span></span>
<span class="r-in"><span><span class="co"># slightly different lambda values and using tauHat.MLE instad of tauHat.GCV</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 95% pointwise prediction intervals</span></span></span>
<span class="r-in"><span><span class="va">Zvalue</span><span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">.0975</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">upper</span><span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">fitted.values</span> <span class="op">+</span> <span class="va">Zvalue</span><span class="op">*</span> <span class="va">SE</span></span></span>
<span class="r-in"><span><span class="va">lower</span><span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">fitted.values</span> <span class="op">-</span> <span class="va">Zvalue</span><span class="op">*</span> <span class="va">SE</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># conservative, simultaneous Bonferroni bounds</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="va">ZBvalue</span><span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">qnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span> <span class="fl">.025</span><span class="op">/</span><span class="va">fit</span><span class="op">$</span><span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">upperB</span><span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">fitted.values</span> <span class="op">+</span> <span class="va">ZBvalue</span><span class="op">*</span> <span class="va">SE</span></span></span>
<span class="r-in"><span><span class="va">lowerB</span><span class="op">&lt;-</span> <span class="va">fit</span><span class="op">$</span><span class="va">fitted.values</span> <span class="op">-</span> <span class="va">ZBvalue</span><span class="op">*</span> <span class="va">SE</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="co"># take a look</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">fit</span><span class="op">$</span><span class="va">x</span>, <span class="va">fit</span><span class="op">$</span><span class="va">y</span>, type<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="envelopePlot.html">envelopePlot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">x</span>, <span class="va">lowerB</span>,<span class="va">fit</span><span class="op">$</span><span class="va">x</span>, <span class="va">upperB</span>, col <span class="op">=</span> <span class="st">"grey90"</span>,</span></span>
<span class="r-in"><span>             lineCol<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="envelopePlot.html">envelopePlot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">x</span>, <span class="va">lower</span>,<span class="va">fit</span><span class="op">$</span><span class="va">x</span>, <span class="va">upper</span>, lineCol<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span> <span class="va">fit</span><span class="op">$</span><span class="va">predicted</span>, col<span class="op">=</span><span class="st">"red"</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span> <span class="va">fit</span><span class="op">$</span><span class="va">x</span>, <span class="va">fit</span><span class="op">$</span><span class="va">y</span>,pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span> <span class="st">"95 pct pointwise  and simultaneous intervals"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="sreg-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># or try the more visually  honest not connecting points</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">fit</span><span class="op">$</span><span class="va">x</span>, <span class="va">fit</span><span class="op">$</span><span class="va">y</span>, type<span class="op">=</span><span class="st">"n"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span>  <span class="va">fit</span><span class="op">$</span><span class="va">x</span>, <span class="va">lowerB</span>, <span class="va">fit</span><span class="op">$</span><span class="va">x</span>, <span class="va">upperB</span>, col<span class="op">=</span><span class="st">"grey"</span>,lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/segments.html" class="external-link">segments</a></span><span class="op">(</span>  <span class="va">fit</span><span class="op">$</span><span class="va">x</span>, <span class="va">lower</span>, <span class="va">fit</span><span class="op">$</span><span class="va">x</span>, <span class="va">upper</span>, col<span class="op">=</span><span class="st">"thistle3"</span>, lwd<span class="op">=</span><span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span> <span class="va">fit</span><span class="op">$</span><span class="va">predicted</span>, lwd<span class="op">=</span><span class="fl">2</span>,col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span> <span class="va">fit</span><span class="op">$</span><span class="va">x</span>, <span class="va">fit</span><span class="op">$</span><span class="va">y</span>,pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span> <span class="st">"95 pct pointwise  and simultaneous intervals"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="sreg-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="set.panel.html">set.panel</a></span><span class="op">(</span> <span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> plot window will lay out plots in a 1 by 1 matrix </span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Douglas Nychka, Reinhard Furrer, John Paige, Stephan Sain, Florian Gerber, Matthew Iverson.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

