<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Some simple functions for subsetting images — image2lz • fields</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Some simple functions for subsetting images — image2lz"><meta property="og:description" content="These function help in subsetting images or reducing its
size by averaging adjecent cells."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fields</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">14.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Tps.html">Tps usage illustration</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/dnychka/fieldsRPackage/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Some simple functions for subsetting images</h1>
    
    <div class="hidden name"><code>image2lz.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>These function help in subsetting images or reducing its
size by averaging adjecent cells.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">crop.image</span><span class="op">(</span><span class="va">obj</span>, loc<span class="op">=</span><span class="cn">NULL</span>,<span class="va">...</span><span class="op">)</span></span>
<span><span class="fu">which.max.matrix</span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span><span class="fu">which.max.image</span><span class="op">(</span><span class="va">obj</span><span class="op">)</span></span>
<span><span class="fu">get.rectangle</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="fu">average.image</span><span class="op">(</span><span class="va">obj</span>, Q<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu">half.image</span><span class="op">(</span><span class="va">obj</span><span class="op">)</span></span>
<span><span class="fu">in.poly</span><span class="op">(</span> <span class="va">xd</span>, <span class="va">xp</span>, convex.hull<span class="op">=</span><span class="cn">FALSE</span>, inflation<span class="op">=</span><span class="fl">1e-07</span><span class="op">)</span></span>
<span><span class="fu">in.poly.grid</span><span class="op">(</span> <span class="va">grid.list</span>,<span class="va">xp</span>, convex.hull<span class="op">=</span><span class="cn">FALSE</span>, inflation<span class="op">=</span><span class="fl">1e-07</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>obj</dt>
<dd><p>A list in image format with the usual x,y  defining the
grid and z a matrix of image values.</p></dd>


 <dt>loc</dt>
<dd><p>A 2 column matrix of locations within the image region
that define the subset. If not specified then the image is plotted and
the rectangle can be specified interactively.</p></dd>

<dt>Q</dt>
<dd><p>Number of pixels to average.</p></dd>

 <dt>xd</dt>
<dd><p>A 2 column matrix of locations that are the points to check 
for being inside a polygon.</p></dd>

 <dt>xp</dt>
<dd><p>A 2 column matrix of locations that are vertices of a 
polygon. The last point is assumed to be connected to the first.</p></dd>

 <dt>convex.hull</dt>
<dd><p>If TRUE then the convex hull of <code>xp</code> is used 
instead of the polygon.</p></dd>

<dt>grid.list</dt>
<dd><p>A list with components x and y specifing the 2-d grid values.
(See help( grid.list) for more details.)</p></dd>

 <dt>inflation</dt>
<dd><p>A small expansion factor to insure that points 
precisely on the boundaries and vertices of the convex hull are included 
as members.</p></dd>

<dt>z</dt>
<dd><p>A matrix of numerical values</p></dd>


 <dt>...</dt>
<dd><p>Graphics arguments passed to image.plot. This 
is only relevant when loc is NULL and the locator function is called via 
<code>get.rectangle</code>.</p></dd>



</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>If <code>loc</code> has more than 2 rows then the largest rectangle 
containing the locations is used.</p>
<dl><dt>crop.image</dt>
<dd><p>Creates a subset of the image <code>obj</code> by taking 
using the largest rectangle in the locations <code>loc</code>. This is useful 
if one needs to extract a image that is no bigger in extant than som 
edata location.  If locations are omitted the parent image is plotted 
and the locations from two mouse clicks on the image. Returned value is 
an image with appropriate <code>x,y</code> and <code>z</code> components.</p></dd>


<dt>get.rectangle</dt>
<dd><p>Given an image plots and waits for two mouse 
clicks that are returned.</p></dd>


<dt>which.max.image</dt>
<dd><p>Returns a list with components <code>x, y, z</code>
, and <code>ind</code> giving the
location of the maximun and value of the maximum in the image based
on the grid values and also on the indicies of the image matrix.</p></dd>


<dt>average.image, half.image</dt>
<dd><p>Takes passed image and averages the 
pixel values and adjusts the grid to create an image that has a smaller 
number of elements. If <code>Q=2</code> in <code>average.image</code> it has the 
same effect as <code>half.image</code> but might be slower -- if the original 
image is mXn then half image will be an image (m/2)X(n/2). This begs the 
question what happens when m or n is odd or when (m/Q) or (n/Q) are not 
integers. In either case the largest rows or columns are dropped. (For 
large <code>Q</code> the function might be modified to drop about half the 
pixels at both edges.)</p></dd>


<dt>in.poly, in.poly.grid</dt>
<dd><p>Determines whether the points xd,yd are 
inside a polygon or outside. Return value is a logical vector with TRUE 
being inside or on boundary of polygon. The test expands the polygon 
slightly in size (on the order of single precision zero) to include 
points that are at the vertices. <code>in.poly</code> does not really depend 
on an image format however the grid version <code>in.poly.grid</code> is more 
efficient for considering the locations on a regular grid
See also <code>in.land.grid</code> that is hard coded to work with the
fields world map.</p></dd>



</dl></div>
    <div id="author">
    <h2>Author</h2>
    <p>Doug Nychka</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>drape.plot, image.plot,
    interp.surface, interp.surface.grid, in.land.grid</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">RMelevation</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># region defining Colorado Front Range</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">loc</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">106.5</span>, <span class="fl">40.8</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">103.9</span>, <span class="fl">37.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># extract elevations for just CO frontrange.</span></span></span>
<span class="r-in"><span>   <span class="va">FR</span><span class="op">&lt;-</span> <span class="fu">crop.image</span><span class="op">(</span><span class="va">RMelevation</span>, <span class="va">loc</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="image.plot.html">image.plot</a></span><span class="op">(</span> <span class="va">FR</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="image2lz-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span>   <span class="fu">which.max.image</span><span class="op">(</span> <span class="va">FR</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -106.25</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $y</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 38.625</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $z</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 3975.202</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $ind</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      ix iy</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  8 29</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># average cells  4 to 1 by doing this twice!</span></span></span>
<span class="r-in"><span>   <span class="va">temp</span><span class="op">&lt;-</span>  <span class="fu">half.image</span><span class="op">(</span> <span class="va">RMelevation</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">temp</span><span class="op">&lt;-</span> <span class="fu">half.image</span><span class="op">(</span> <span class="va">temp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># or in one step</span></span></span>
<span class="r-in"><span>   <span class="va">temp</span><span class="op">&lt;-</span>  <span class="fu">average.image</span><span class="op">(</span> <span class="va">RMelevation</span>, Q<span class="op">=</span><span class="fl">4</span><span class="op">)</span><span class="op">-&gt;</span> <span class="va">temp</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="image.plot.html">image.plot</a></span><span class="op">(</span> <span class="va">temp</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">terrain.colors</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="image2lz-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># a polygon (no special meaning entered with just locator)</span></span></span>
<span class="r-in"><span><span class="va">x1p</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span> <span class="op">-</span><span class="fl">106.2017</span>, <span class="op">-</span><span class="fl">104.2418</span>, <span class="op">-</span><span class="fl">102.9182</span>, <span class="op">-</span><span class="fl">102.8163</span>, <span class="op">-</span><span class="fl">102.8927</span>, <span class="op">-</span><span class="fl">103.3254</span>, <span class="op">-</span><span class="fl">104.7763</span>,</span></span>
<span class="r-in"><span> <span class="op">-</span><span class="fl">106.5581</span>, <span class="op">-</span><span class="fl">108.2889</span>, <span class="op">-</span><span class="fl">109.1035</span>, <span class="op">-</span><span class="fl">109.3325</span>, <span class="op">-</span><span class="fl">108.7980</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">x2p</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="fl">43.02978</span>, <span class="fl">42.80732</span>, <span class="fl">41.89727</span>, <span class="fl">40.84566</span>, <span class="fl">39.81427</span>, <span class="fl">38.17618</span>, <span class="fl">36.53810</span>, <span class="fl">36.29542</span>,</span></span>
<span class="r-in"><span>  <span class="fl">36.90211</span>, <span class="fl">38.29752</span>, <span class="fl">39.45025</span>, <span class="fl">41.02767</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">xp</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span> <span class="va">x1p</span>,<span class="va">x2p</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="fu"><a href="image.plot.html">image.plot</a></span><span class="op">(</span> <span class="va">temp</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span> <span class="va">xp</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">xp</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="image2lz-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># find all grid points inside poly</span></span></span>
<span class="r-in"><span> <span class="va">fullset</span><span class="op">&lt;-</span> <span class="fu"><a href="grid.list.html">make.surface.grid</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> x<span class="op">=</span> <span class="va">temp</span><span class="op">$</span><span class="va">x</span>, y<span class="op">=</span> <span class="va">temp</span><span class="op">$</span><span class="va">y</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="va">ind</span><span class="op">&lt;-</span>  <span class="fu">in.poly</span><span class="op">(</span> <span class="va">fullset</span>,<span class="va">xp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># take a look </span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">fullset</span>, pch<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span> <span class="va">xp</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">xp</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span> <span class="va">fullset</span><span class="op">[</span><span class="va">ind</span>,<span class="op">]</span>, pch<span class="op">=</span><span class="st">"o"</span>, col<span class="op">=</span><span class="st">"red"</span>, cex<span class="op">=</span><span class="fl">.5</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="image2lz-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># masking out the image NA == white in the image plot</span></span></span>
<span class="r-in"><span> <span class="va">temp</span><span class="op">$</span><span class="va">z</span><span class="op">[</span><span class="op">!</span><span class="va">ind</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="image.plot.html">image.plot</a></span><span class="op">(</span> <span class="va">temp</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/graphics/polygon.html" class="external-link">polygon</a></span><span class="op">(</span> <span class="va">xp</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">xp</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="image2lz-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># This is more efficient for large grids:</span></span></span>
<span class="r-in"><span><span class="co"># because the large number of grid location ( xg above) is </span></span></span>
<span class="r-in"><span><span class="co"># never explicitly created.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="va">ind</span><span class="op">&lt;-</span> <span class="fu">in.poly.grid</span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> x<span class="op">=</span> <span class="va">temp</span><span class="op">$</span><span class="va">x</span>, y<span class="op">=</span> <span class="va">temp</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>, <span class="va">xp</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># now use ind in the same way as above to mask points outside of polygon</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Douglas Nychka, Reinhard Furrer, John Paige, Stephan Sain, Florian Gerber, Matthew Iverson.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

