<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Unconditional and conditional simulation of a spatial process — sim.spatialProcess • fields</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Unconditional and conditional simulation of a spatial process — sim.spatialProcess"><meta property="og:description" content="Generates exact (or approximate) random draws from the unconditional or
conditional 
distribution of a spatial process given specific observations. 
Draws from the conditional distribution, known as conditional simulation in geostatistics,  is a 
useful way to characterize the uncertainty in the predicted process from 
data.  Note that exact simulation is limted by the number of locations but there are approximate strategies to handle simulation for large grids of locations."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fields</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">14.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Tps.html">Tps usage illustration</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/dnychka/fieldsRPackage/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Unconditional and conditional simulation of a spatial process</h1>
    
    <div class="hidden name"><code>sim.Krig.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Generates exact (or approximate) random draws from the unconditional or
conditional 
distribution of a spatial process given specific observations. 
Draws from the conditional distribution, known as conditional simulation in geostatistics,  is a 
useful way to characterize the uncertainty in the predicted process from 
data.  Note that exact simulation is limted by the number of locations but there are approximate strategies to handle simulation for large grids of locations.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">simSpatialData</span><span class="op">(</span><span class="va">object</span>,  M <span class="op">=</span> <span class="fl">1</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">sim.spatialProcess</span><span class="op">(</span><span class="va">object</span>, <span class="va">xp</span>,  M <span class="op">=</span> <span class="fl">1</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="fu">sim.Krig</span><span class="op">(</span><span class="va">object</span>, <span class="va">xp</span>, M <span class="op">=</span> <span class="fl">1</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">simLocal.spatialProcess</span><span class="op">(</span><span class="va">mKrigObject</span>, predictionGridList <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                 simulationGridList <span class="op">=</span> <span class="cn">NULL</span>, gridRefinement <span class="op">=</span> <span class="fl">1</span>, np <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                 M <span class="op">=</span> <span class="fl">1</span>, nx <span class="op">=</span> <span class="fl">80</span>, ny <span class="op">=</span> <span class="fl">80</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span>, delta <span class="op">=</span></span>
<span>                 <span class="cn">NULL</span>, giveWarnings <span class="op">=</span> <span class="cn">TRUE</span>, fast <span class="op">=</span> <span class="cn">FALSE</span>, NNSize <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                 <span class="va">...</span><span class="op">)</span></span>
<span>             </span>
<span><span class="fu">checkPredictGrid</span><span class="op">(</span><span class="va">predictionGridList</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">makePredictionGridList</span><span class="op">(</span><span class="va">mKrigObject</span>, <span class="va">nx</span>, <span class="va">ny</span>, <span class="va">np</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">makeSimulationGrid</span><span class="op">(</span><span class="va">predictionGridList</span>, <span class="va">gridRefinement</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>delta</dt>
<dd><p>If the covariance has compact support the simulation method can 
take advantage of this. This is the amount of buffer added for the simulation domain in the circulant embedding method. 
A minimum size would be <code>aRange</code> for the Wendland but a multiple of this maybe needed to obtain a positive definite 
circulant covariance function.</p></dd>


 
  <dt>fast</dt>
<dd><p>If TRUE will use approximate,
                fast spatial prediction on grids.</p></dd>

  
   <dt>gridRefinement</dt>
<dd><p>Amount to increase the number of grid points
  for the simulation grid.</p></dd>



<dt>giveWarnings</dt>
<dd><p>If true will warn when more than one observation is in a grid box. This is instead of giving an error and stopping.</p></dd>


  <dt>mKrigObject</dt>
<dd><p>An mKrig Object (or spatialProcess object)</p></dd>


 
  <dt>M</dt>
<dd><p>Number of draws from conditional distribution.</p></dd>

   <dt>np</dt>
<dd><p>Degree of nearest neighbors to use. In the 2D case, the default <code>np=2</code> uses 16
   points in a 4X4 grid for prediction of the off grid point.</p></dd>

  <dt>NNSize</dt>
<dd><p>Degree of neighborhood use for fast prediction.
  ( See <code> predictSurface.mKrig</code>  with <code>fast= TRUE</code> )</p></dd>
 
  <dt>nx</dt>
<dd><p>Number of grid points in prediction locations for x coordinate.</p></dd>

  <dt>ny</dt>
<dd><p>Number of grid points in  prediction locations for x coordinate.</p></dd>


  <dt>object</dt>
<dd><p>The spatial fit object.</p></dd>

  
   <dt>predictionGridList</dt>
<dd><p>A grid list specifying the grid locations
   for the conditional samples.</p></dd>

 

  <dt>simulationGridList</dt>
<dd><p>A <code>gridlist</code> describing grid for
simulation. If missing this is created from the range of the
locations, <code>nx</code>, <code>ny</code>, <code>gridRefinement</code>, and
<code>gridExpansion</code>
or from the range and and <code>nxSimulation</code>, <code>nySimulation</code>.</p></dd>


 
  <dt>xp</dt>
<dd><p>Same as predictionPoints above.</p></dd>


 <dt>...</dt>
<dd><p>Any other arguments to be passed to the predict function.
 	Usually this is the <code>Z</code> or <code>drop.Z</code> argument when there are 
 	additional covariates in the fixed part of the model.
 	(See example below.)</p></dd>


  <dt>verbose</dt>
<dd><p>If true prints out intermediate information.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    

<p>These functions generate samples from an unconditional or conditional multivariate (spatial) 
distribution, or an approximate one. The <strong>unconditional</strong> simulation function,
<code>simSpatialData</code>,
is a handy way to generate synthetic observations from a fitted model.
Typically one would use these for a parametric bootstrap.
The functions that simulate <strong>conditional</strong> distributions are much
more involved
in their coding. They are useful
for describing the uncertainty in predictions using the estimated spatial 
process under Gaussian assumptions. An important assumption throughout 
these functions is that all covariance parameters are fixed at their 
estimated or prescribed values from the passed object. Although these functions might
be coded up easily by the users these
versions have the advantage that they take the <code>mKrig</code>, <code>spatialProcess</code> or
<code>Krig</code> objects as a way to specify the
model in an unambiguous way.</p>
<p>Given a spatial process  h(x)= P(x) + g(x) observed at</p>
<p>Y.k =  Z(x.k)d + P(x.k) + g(x.k) + e.k</p>
<p>where P(x) is a low order, fixed polynomial and g(x) a Gaussian spatial 
process and Z(x.k) is a vector of covariates that are also indexed by space (such as elevation).
Z(x.k)d is a linear combination of the covariates with the parameter vector d being a
component of the fixed part of the 
model and estimated in the usual way by generalized least squares.</p>
<p>With Y= Y.1, ..., Y.N,
the goal is to sample the conditional distribution of the process.</p> 
<p>[h(x) | Y ]  or the full prediction Z(x)d + h(x)</p>
<p>For fixed a covariance this is just a multivariate normal sampling
problem.  <code>sim.spatialProcess</code> samples this conditional process at
the points <code>xp</code> and is exact for fixed covariance parameters.</p>
<p>The outline of the conditional simulation algorithm is given below and has the
advantage that is only depends on the unconditional simulation
of the spatial process and being able to make a spatial prediction - the
conditional mean of the process given the observations and covariance function.</p>
<p><strong> Conditional Simulation Algorithm: </strong></p>
<p>0) Find the spatial prediction at the unobserved locations based on
 the actual data. Call this h.hat(x) and this is also  the conditional mean.</p>
<p>1) Generate a realization that includes both prediction and observation locations from the unconditional spatial process and from this process
simluate synthetic observations.</p>
<p>2) Use the spatial prediction model ( using the true covariance) to
estimate the spatial process at unobserved locations.</p>
<p>3) Find the difference between the simulated process and its
prediction based on synthetic observations. Call this e(x).</p>
<p>4) h.hat(x) + e(x) is a draw from [h(x) | Y ].</p>
<p>The approximations for this simulation come in at step 1).
Here the field at the observation locations is
approximated using a local conditional simulation from
the nearest grid points.</p>
<p>NOTE: A fixed part in the model is handled easily by
simply
making the prediction from the synthetic observations
that have mean zero but include estimation of the
fixed part as part of the prediction. 
Because the
regression estimates are unbaised, this gives a
valid draw from the correct mulitvariate distribution
even though the synthetic observations do not include
a fixed part.</p>

<p><code>sim.spatialProcess</code> Follows this algorithm exactly. For the case of an
addtional covariate  this of course needs to be included. For a model
with covariates use <code>drop.Z=TRUE</code> for the function to ignore prediction
using the covariate and generate conditional samples for just the spatial
process and any low order polynomial. Finally, it should be noted that this
function will also work with an <code>mKrig</code> object because the essential
prediction information in the mKrig and spatialProcess objects are the same.
The naming is through convenience.</p>
<p><code>sim.Krig</code>  Also follows this algorithm exactly but for the older <code>Krig</code> object.  Note the inclusion of
drop.Z=TRUE or FALSE will determine whether the conditional simulation 
includes the covariates Z or not. (See example below.) 
<code>simLocal.spatialProcess</code>This function is
designed for conditional simulation for a large
prediction grid and for a large number of observation
s. The approximation will be accurate for fine grids
that separate clusters of observation locations. E.g.
multiple observations in a single gridbox are treated
exactly. If observation location are separated by a
grid box then due to the screening effect the
approximation error will be negliable, especially if a
nugget component  (tau ) is present. The 1D version of this function will not be much more
efficient than an exact computation. However, it is
included as easy to read source code and for checking
(see examples.)See the utility function <code><a href="offGridWeights.html">offGridWeights</a></code> for the function that creates weights used to generate the (approximate) conditional sample.  The functions 
<code>checkPredictGrid</code>, 
<code>makePredictionGridList</code> and 
<code>makeSimulationGrid</code> are utilities to setup the grids when not specified.</p>


    </div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>sim.Krig and sim.spatialProcess</code></p>


<p>a matrix with rows indexed by the locations in <code>xp</code> and columns being the</p>
<p></p>
<p><code>M</code> independent draws.</p>


<p><code>simLocal.spatialProcess</code> a list with components <code>x</code>, <code>y</code></p>


<p>and <code>z</code> being the simulations at the prediction grid.
The x and y are the typical image format specifying a regular grid.  If
<code>nx</code> and <code>ny</code> are the lengths of the grid values in X and Y then  <code>z</code></p>


<p>is a array with dimension  <code> c(nx, ny, M)</code>. For the 1D case ny is set to 1.
The component <code>hHat</code> is the conditional mean ( as an 
<code>nx</code> X <code>ny</code> matrix)  and the remaining arguments
are various timing results for parts of the computation.</p>
 

    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Doug Nychka</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>sim.rf, Krig, spatialProcess</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## 10 member ensemble for the O3 data</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span> <span class="st">"ozone2"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fitObject</span><span class="op">&lt;-</span> <span class="fu"><a href="spatialProcess.html">spatialProcess</a></span><span class="op">(</span> <span class="va">ozone2</span><span class="op">$</span><span class="va">lon.lat</span>, <span class="va">ozone2</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fl">16</span>,<span class="op">]</span>,</span></span>
<span class="r-in"><span>                              smoothness<span class="op">=</span><span class="fl">.5</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">nx</span><span class="op">&lt;-</span> <span class="fl">65</span></span></span>
<span class="r-in"><span><span class="va">ny</span><span class="op">&lt;-</span> <span class="fl">55</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">xGridList</span><span class="op">&lt;-</span> <span class="fu"><a href="grid.list.html">fields.x.to.grid</a></span><span class="op">(</span> <span class="va">fitObject</span><span class="op">$</span><span class="va">x</span>, nx<span class="op">=</span><span class="va">nx</span>, ny<span class="op">=</span><span class="va">ny</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">xGrid</span><span class="op">&lt;-</span> <span class="fu"><a href="grid.list.html">make.surface.grid</a></span><span class="op">(</span> <span class="va">xGridList</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">allTime0</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span></span>
<span class="r-in"><span> <span class="va">look0</span><span class="op">&lt;-</span> <span class="fu">sim.spatialProcess</span><span class="op">(</span><span class="va">fitObject</span>, xp<span class="op">=</span><span class="va">xGrid</span>, M<span class="op">=</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="va">allTime0</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># for M=5 this does not make much sense ... however here are the </span></span></span>
<span class="r-in"><span><span class="co"># Monte Carlo based prediction standard deviations. </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">predictSE</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">look0</span>, <span class="fl">1</span>, <span class="va">sd</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compare to  predictSE(fitObject, xp=xGrid)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Local simulation with extra refinement of the grid for embedding</span></span></span>
<span class="r-in"><span><span class="co">## and same grid size for prediction </span></span></span>
<span class="r-in"><span><span class="co">## this runs much faster compared to exact method above </span></span></span>
<span class="r-in"><span><span class="co">## as nx, ny are increased  e.g. nx= 128, ny=128 is dramatic difference </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">allTime1</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">look</span><span class="op">&lt;-</span> <span class="fu">simLocal.spatialProcess</span><span class="op">(</span><span class="va">fitObject</span>, M<span class="op">=</span><span class="fl">5</span>,nx<span class="op">=</span><span class="va">nx</span>, ny<span class="op">=</span><span class="va">ny</span>,</span></span>
<span class="r-in"><span>                     gridRefinement <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                     np<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="va">allTime1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="va">look</span><span class="op">$</span><span class="va">timing</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">allTime2</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  <span class="va">look</span><span class="op">&lt;-</span> <span class="fu">simLocal.spatialProcess</span><span class="op">(</span><span class="va">fitObject</span>, M<span class="op">=</span><span class="fl">5</span>,nx<span class="op">=</span><span class="va">nx</span>, ny<span class="op">=</span><span class="va">ny</span>,</span></span>
<span class="r-in"><span>                     gridRefinement <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                     np<span class="op">=</span><span class="fl">3</span>, </span></span>
<span class="r-in"><span>                     fast<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="va">allTime2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="va">look</span><span class="op">$</span><span class="va">timing</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## A simple example for setting up a bootstrap </span></span></span>
<span class="r-in"><span><span class="co">## M below should be</span></span></span>
<span class="r-in"><span><span class="co">## set to a much larger sample size, however, ( e.g. M &lt;- 200) for better</span></span></span>
<span class="r-in"><span><span class="co">## statistics</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span> <span class="va">ozone2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">obj</span><span class="op">&lt;-</span> <span class="fu"><a href="spatialProcess.html">spatialProcess</a></span><span class="op">(</span> <span class="va">ozone2</span><span class="op">$</span><span class="va">lon.lat</span>,<span class="va">ozone2</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fl">16</span>,<span class="op">]</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">aHat</span><span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span><span class="st">"aRange"</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">lambdaHat</span><span class="op">&lt;-</span> <span class="va">obj</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span><span class="st">"lambda"</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">######### boot strap </span></span></span>
<span class="r-in"><span><span class="co"># create M independent copies of the observation vector</span></span></span>
<span class="r-in"><span><span class="co"># here we just grab the model information from the </span></span></span>
<span class="r-in"><span><span class="co"># spatialProcess object above.</span></span></span>
<span class="r-in"><span><span class="co">#  </span></span></span>
<span class="r-in"><span><span class="co"># However, one could just create the list </span></span></span>
<span class="r-in"><span><span class="co">#  obj&lt;- list( x= ozone2$lon.lat,</span></span></span>
<span class="r-in"><span><span class="co">#       cov.function.name="stationary.cov",</span></span></span>
<span class="r-in"><span><span class="co">#     summary= c( tau= 9.47, sigma2= 499.79, aRange= .700),</span></span></span>
<span class="r-in"><span><span class="co">#    cov.args= list( Covariance="Matern", smoothness=1.0),</span></span></span>
<span class="r-in"><span><span class="co">#     weights= rep( 1, nrow(ozone2$lon.lat) )</span></span></span>
<span class="r-in"><span><span class="co"># )</span></span></span>
<span class="r-in"><span><span class="co"># Here summary component  has the parameters</span></span></span>
<span class="r-in"><span><span class="co"># tau, sigma2 and aRange</span></span></span>
<span class="r-in"><span><span class="co"># and cov.args component has the remaining ones.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">223</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">M</span><span class="op">&lt;-</span> <span class="fl">25</span></span></span>
<span class="r-in"><span><span class="va">ySynthetic</span><span class="op">&lt;-</span> <span class="fu">simSpatialData</span><span class="op">(</span> <span class="va">obj</span>, <span class="va">M</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">bootSummary</span><span class="op">&lt;-</span> <span class="cn">NULL</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">for</span><span class="op">(</span>  <span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">M</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span> <span class="va">k</span>, <span class="st">" "</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># here the MLEs are found using the easy top level level wrapper</span></span></span>
<span class="r-in"><span><span class="co"># see mKrigMLEJoint for a more efficient strategy</span></span></span>
<span class="r-in"><span>  <span class="va">newSummary</span><span class="op">&lt;-</span> <span class="fu"><a href="spatialProcess.html">spatialProcess</a></span><span class="op">(</span><span class="va">obj</span><span class="op">$</span><span class="va">x</span>,<span class="va">ySynthetic</span><span class="op">[</span>,<span class="va">k</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                    cov.params.start<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>                         aRange <span class="op">=</span> <span class="va">aHat</span>,</span></span>
<span class="r-in"><span>                        lambda <span class="op">=</span> <span class="va">lambdaHat</span><span class="op">)</span></span></span>
<span class="r-in"><span>                               <span class="op">)</span><span class="op">$</span><span class="va">summary</span></span></span>
<span class="r-in"><span>  <span class="va">bootSummary</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span> <span class="va">bootSummary</span>, <span class="va">newSummary</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">}</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span> fill<span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># the results and 95</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="stats.html">stats</a></span><span class="op">(</span> <span class="va">bootSummary</span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">obj</span><span class="op">$</span><span class="va">summary</span></span></span>
<span class="r-in"><span>  <span class="va">tmpBoot</span><span class="op">&lt;-</span> <span class="va">bootSummary</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lambda"</span>, <span class="st">"aRange"</span><span class="op">)</span> <span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">confidenceInterval</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">tmpBoot</span>, <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                               <span class="va">quantile</span>, probs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.025</span>,<span class="fl">0.975</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># compare to estimates used as the "true" parameters             </span></span></span>
<span class="r-in"><span>  <span class="va">obj</span><span class="op">$</span><span class="va">summary</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span> </span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">confidenceInterval</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># compare to confidence interval using large sample theory  </span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span> <span class="va">obj</span><span class="op">$</span><span class="va">CITable</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co"># conditional simulation with covariates</span></span></span>
<span class="r-in"><span><span class="co"># colorado climate example</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">COmonthlyMet</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">fit1E</span><span class="op">&lt;-</span> <span class="fu"><a href="spatialProcess.html">spatialProcess</a></span><span class="op">(</span><span class="va">CO.loc</span>,<span class="va">CO.tmin.MAM.climate</span>, Z<span class="op">=</span><span class="va">CO.elev</span>   <span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># conditional simulation at missing data</span></span></span>
<span class="r-in"><span>  <span class="va">good</span><span class="op">&lt;-</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">CO.tmin.MAM.climate</span> <span class="op">)</span> </span></span>
<span class="r-in"><span>  <span class="va">infill</span><span class="op">&lt;-</span> <span class="fu">sim.spatialProcess</span><span class="op">(</span> <span class="va">fit1E</span>, xp<span class="op">=</span><span class="va">CO.loc</span><span class="op">[</span><span class="op">!</span><span class="va">good</span>,<span class="op">]</span>, </span></span>
<span class="r-in"><span>                Z<span class="op">=</span> <span class="va">CO.elev</span><span class="op">[</span><span class="op">!</span><span class="va">good</span><span class="op">]</span>, M<span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># get an elevation grid  ... NGRID&lt;- 50 gives a nicer image but takes longer </span></span></span>
<span class="r-in"><span> <span class="va">NGRID</span> <span class="op">&lt;-</span> <span class="fl">25</span>  </span></span>
<span class="r-in"><span> <span class="co"># get elevations on a grid  </span></span></span>
<span class="r-in"><span>   <span class="va">COGrid</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span> <span class="op">-</span><span class="fl">109.5</span>, <span class="op">-</span><span class="fl">100.5</span>, ,<span class="va">NGRID</span><span class="op">)</span>, y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">36</span>, <span class="fl">41.75</span>,,<span class="va">NGRID</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">COGridPoints</span><span class="op">&lt;-</span> <span class="fu"><a href="grid.list.html">make.surface.grid</a></span><span class="op">(</span> <span class="va">COGrid</span><span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># elevations are a bilinear interpolation from the 4km</span></span></span>
<span class="r-in"><span> <span class="co"># Rocky Mountain elevation fields data set.   </span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span> <span class="va">RMelevation</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="va">COElevGrid</span><span class="op">&lt;-</span> <span class="fu"><a href="interp.surface.html">interp.surface</a></span><span class="op">(</span> <span class="va">RMelevation</span>, <span class="va">COGridPoints</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># NOTE call to sim.spatialProcess treats the grid points as just a matrix</span></span></span>
<span class="r-in"><span><span class="co"># of locations the plot has to "reshape" these into a grid </span></span></span>
<span class="r-in"><span><span class="co"># to use with image.plot </span></span></span>
<span class="r-in"><span>   <span class="va">SEout</span><span class="op">&lt;-</span> <span class="fu">sim.spatialProcess</span><span class="op">(</span> <span class="va">fit1E</span>, xp<span class="op">=</span><span class="va">COGridPoints</span>,  Z<span class="op">=</span> <span class="va">COElevGrid</span>, M<span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># for just the smooth surface in lon/lat</span></span></span>
<span class="r-in"><span><span class="co">#  SEout&lt;- sim.spatialProcess( fit1E, xp=COGridPoints,  drop.Z=TRUE, M= 30)</span></span></span>
<span class="r-in"><span><span class="co"># in practice M should be larger to reduce Monte Carlo error.      </span></span></span>
<span class="r-in"><span>   <span class="va">surSE</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">SEout</span>, <span class="fl">1</span>, <span class="va">sd</span> <span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="image.plot.html">image.plot</a></span><span class="op">(</span> <span class="fu"><a href="as.surface.html">as.surface</a></span><span class="op">(</span> <span class="va">COGridPoints</span>, <span class="va">surSE</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span>   <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span> <span class="va">fit1E</span><span class="op">$</span><span class="va">x</span>, col<span class="op">=</span><span class="st">"magenta"</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span> </span></span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">### Approximate conditional simulation </span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span> <span class="co"># create larger lon/lat grid  </span></span></span>
<span class="r-in"><span>   <span class="va">NGRID</span> <span class="op">&lt;-</span> <span class="fl">200</span>  </span></span>
<span class="r-in"><span>   <span class="va">COGrid</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span> <span class="op">-</span><span class="fl">109.7</span>, <span class="op">-</span><span class="fl">100.5</span>, ,<span class="va">NGRID</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                    y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">36</span>, <span class="fl">41.75</span>,,<span class="va">NGRID</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-in"><span> <span class="co"># interpolation elevations to this grid. </span></span></span>
<span class="r-in"><span> <span class="co"># This took about 40 seconds</span></span></span>
<span class="r-in"><span>   <span class="va">COElevGrid</span><span class="op">&lt;-</span> <span class="fu"><a href="interp.surface.html">interp.surface.grid</a></span><span class="op">(</span> <span class="va">RMelevation</span>, <span class="va">COGrid</span> <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span> </span></span>
<span class="r-in"><span>    <span class="va">SEout0</span><span class="op">&lt;-</span> <span class="fu">simLocal.spatialProcess</span><span class="op">(</span> <span class="va">fit1E</span>,<span class="va">COGrid</span> , </span></span>
<span class="r-in"><span>    ZGrid<span class="op">=</span> <span class="va">COElevGrid</span><span class="op">$</span><span class="va">z</span>,</span></span>
<span class="r-in"><span>    M<span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span><span class="co">### Approximate conditional simulation and with approximate prediction</span></span></span>
<span class="r-in"><span><span class="co">### increase  np and NNSize to improve approximations </span></span></span>
<span class="r-in"><span><span class="co">### This takes about 8 seconds of course one would want more thatn 10 reps</span></span></span>
<span class="r-in"><span><span class="co">### to estimate the SE. Use drop.Z=TRUE to just get the spatial surface without ### the fixed part </span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>   <span class="va">SEout2</span><span class="op">&lt;-</span> <span class="fu">simLocal.spatialProcess</span><span class="op">(</span> <span class="va">fit1E</span>, <span class="va">COGrid</span> , </span></span>
<span class="r-in"><span>                   ZGrid<span class="op">=</span> <span class="va">COElevGrid</span><span class="op">$</span><span class="va">z</span>, np <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>   fast<span class="op">=</span> <span class="cn">TRUE</span>, NNSize<span class="op">=</span><span class="fl">5</span>, M<span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="op">)</span></span></span>
<span class="r-in"><span>   </span></span>
<span class="r-in"><span>  <span class="va">look</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span> <span class="va">SEout2</span><span class="op">$</span><span class="va">z</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, <span class="va">sd</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="imagePlot.html">imagePlot</a></span><span class="op">(</span><span class="va">SEout2</span><span class="op">$</span><span class="va">x</span>, <span class="va">SEout2</span><span class="op">$</span><span class="va">y</span>, <span class="va">look</span>, col<span class="op">=</span><span class="fu"><a href="https://sjmgarnier.github.io/viridisLite/reference/viridis.html" class="external-link">viridis</a></span><span class="op">(</span><span class="fl">256</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span> <span class="va">fit1E</span><span class="op">$</span><span class="va">x</span>, pch<span class="op">=</span><span class="fl">16</span>, cex<span class="op">=</span><span class="fl">.5</span>, col<span class="op">=</span><span class="st">"magenta"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Monte Carlo prediction SE"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#### example using Krig object and exact conditional simulation.</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span> <span class="va">ozone2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span> <span class="fl">399</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># fit to day 16 from Midwest ozone data set.</span></span></span>
<span class="r-in"><span>  <span class="va">out</span><span class="op">&lt;-</span> <span class="fu"><a href="Krig.html">Krig</a></span><span class="op">(</span> <span class="va">ozone2</span><span class="op">$</span><span class="va">lon.lat</span>, <span class="va">ozone2</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fl">16</span>,<span class="op">]</span>, Covariance<span class="op">=</span><span class="st">"Matern"</span>, </span></span>
<span class="r-in"><span>            aRange<span class="op">=</span><span class="fl">1.0</span>,smoothness<span class="op">=</span><span class="fl">1.0</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># NOTE aRange =1.0 is not the best choice but </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># the six missing data locations</span></span></span>
<span class="r-in"><span> <span class="va">xp</span><span class="op">&lt;-</span>  <span class="va">ozone2</span><span class="op">$</span><span class="va">lon.lat</span><span class="op">[</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">ozone2</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fl">16</span>,<span class="op">]</span><span class="op">)</span>,<span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># 30 draws from process at xp given the data </span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="va">sim.out</span><span class="op">&lt;-</span> <span class="fu">sim.Krig</span><span class="op">(</span> <span class="va">out</span>,<span class="va">xp</span>, M<span class="op">=</span><span class="fl">30</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## testing the local method on a 1D case.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">124</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="co"># 10 observations -- massive dataset!</span></span></span>
<span class="r-in"><span><span class="va">s</span><span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>  <span class="fl">10</span>, <span class="fl">5</span>,<span class="fl">45</span><span class="op">)</span><span class="op">)</span> </span></span>
<span class="r-in"><span><span class="va">y</span><span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>  <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">aRange</span><span class="op">&lt;-</span> <span class="fl">10</span> </span></span>
<span class="r-in"><span><span class="va">obj</span><span class="op">&lt;-</span> <span class="fu"><a href="mKrig.html">mKrig</a></span><span class="op">(</span> <span class="va">s</span>, <span class="va">y</span>, aRange<span class="op">=</span><span class="va">aRange</span>,Covariance<span class="op">=</span><span class="st">"Matern"</span>,</span></span>
<span class="r-in"><span>             smoothness<span class="op">=</span><span class="fl">1.0</span>,</span></span>
<span class="r-in"><span>             lambda<span class="op">=</span><span class="fl">.01</span>,tau<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fl">.01</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                      m<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#                    </span></span></span>
<span class="r-in"><span><span class="co"># M should be much larger for an accurate check on code</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">gridList</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span> x<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">50</span>, length.out<span class="op">=</span><span class="fl">15</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">look</span><span class="op">&lt;-</span> <span class="fu">simLocal.spatialProcess</span><span class="op">(</span><span class="va">obj</span>,</span></span>
<span class="r-in"><span>                               np<span class="op">=</span><span class="fl">3</span>,</span></span>
<span class="r-in"><span>                               predictionGridList <span class="op">=</span> <span class="va">gridList</span>,</span></span>
<span class="r-in"><span>                               gridRefinement <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>                               M<span class="op">=</span><span class="fl">50</span>, extrap<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> </span></span>
<span class="r-in"><span>                               </span></span>
<span class="r-in"><span><span class="va">simSE</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">look</span><span class="op">$</span><span class="va">z</span>, <span class="fl">1</span>, <span class="va">sd</span> <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">checkSE</span><span class="op">&lt;-</span> <span class="fu"><a href="predictSE.Krig.html">predictSE</a></span><span class="op">(</span> <span class="va">obj</span>, xnew<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">look</span><span class="op">$</span><span class="va">x</span> <span class="op">)</span>, drop.Z<span class="op">=</span><span class="cn">TRUE</span> <span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># percentage error from true SE at each location.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="stats.html">stats</a></span><span class="op">(</span> <span class="fl">100</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span> <span class="va">simSE</span><span class="op">/</span><span class="va">checkSE</span><span class="op">)</span> <span class="op">)</span></span></span>
<span class="r-in"><span>    </span></span>
<span class="r-in"><span><span class="co"># Maggie plot  </span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">look</span><span class="op">$</span><span class="va">x</span>, <span class="va">checkSE</span>, type<span class="op">=</span><span class="st">"b"</span>, col<span class="op">=</span><span class="st">"blue"</span>,</span></span>
<span class="r-in"><span>xlab<span class="op">=</span><span class="st">"Location"</span>, ylab<span class="op">=</span><span class="st">"Prediction SE"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/rug.html" class="external-link">rug</a></span><span class="op">(</span> <span class="va">look</span><span class="op">$</span><span class="va">x</span>, col<span class="op">=</span><span class="st">"blue"</span>, lwd<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span> <span class="va">look</span><span class="op">$</span><span class="va">x</span>, <span class="va">simSE</span>, col<span class="op">=</span><span class="st">"orange3"</span>, pch<span class="op">=</span><span class="fl">16</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="xline.html">xline</a></span><span class="op">(</span> <span class="va">s</span>, col<span class="op">=</span><span class="st">"grey"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Exact (blue) and Monte Carlo (orange) </span></span></span>
<span class="r-in"><span><span class="st">for the prediction SE based on observations (grey) "</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Douglas Nychka, Reinhard Furrer, John Paige, Stephan Sain, Florian Gerber, Matthew Iverson.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

