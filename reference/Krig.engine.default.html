<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Basic linear algebra utilities and other 
    computations supporting the Krig function. — The Engines: • fields</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Basic linear algebra utilities and other 
    computations supporting the Krig function. — The Engines:"><meta property="og:description" content="These are internal functions to Krig that compute the basic matrix
decompositions or solve the linear systems needed to evaluate the 
Krig/Tps estimate. Others listed below do some simple housekeeping and 
formatting. Typically they are called from within Krig but can also be
used directly if passed a Krig object list."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fields</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">14.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Tps.html">Tps usage illustration</a>
    </li>
    <li>
      <a href="../articles/fastTps.html">fastTps</a>
    </li>
    <li>
      <a href="../articles/predictSurface.html">predictSurface</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/dnychka/fieldsRPackage/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Basic linear algebra utilities and other 
    computations supporting the Krig function.</h1>
    
    <div class="hidden name"><code>Krig.engine.default.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>These are internal functions to Krig that compute the basic matrix
decompositions or solve the linear systems needed to evaluate the 
Krig/Tps estimate. Others listed below do some simple housekeeping and 
formatting. Typically they are called from within Krig but can also be
used directly if passed a Krig object list.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">Krig.engine.default</span><span class="op">(</span><span class="va">out</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">Krig.engine.fixed</span><span class="op">(</span> <span class="va">out</span>, verbose<span class="op">=</span><span class="cn">FALSE</span>, lambda<span class="op">=</span><span class="cn">NA</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">Krig.coef</span><span class="op">(</span><span class="va">out</span>, lambda <span class="op">=</span> <span class="va">out</span><span class="op">$</span><span class="va">lambda</span>, y <span class="op">=</span> <span class="cn">NULL</span>, yM <span class="op">=</span> <span class="cn">NULL</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span><span class="fu">Krig.make.u</span><span class="op">(</span><span class="va">out</span>, y <span class="op">=</span> <span class="cn">NULL</span>, yM <span class="op">=</span> <span class="cn">NULL</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span><span class="fu">Krig.check.xY</span><span class="op">(</span><span class="va">x</span>, <span class="va">Y</span>,<span class="va">Z</span>, <span class="va">weights</span>, <span class="va">na.rm</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> </span>
<span><span class="fu">Krig.transform.xY</span><span class="op">(</span><span class="va">obj</span>, <span class="va">knots</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">Krig.make.W</span><span class="op">(</span> <span class="va">out</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu">Krig.make.Wi</span> <span class="op">(</span> <span class="va">out</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>out</dt>
<dd><p>A complete or partial Krig object. If partial it must have
all the information accumulated to this calling point within the Krig
function.</p></dd>


<dt>obj</dt>
<dd><p>Same as <code>out</code>.</p></dd>


<dt>verbose</dt>
<dd><p>If TRUE prints out intermediate results for
debugging.</p></dd>


<dt>lambda</dt>
<dd><p>Value of smoothing parameter "hard wired" into decompositions. 
Default is NA, i.e.  use the value in <code>out\$lambda</code>.</p></dd>



<dt>y</dt>
<dd><p>New y vector for recomputing coefficients. OR for %d*% a
vector or matrix.</p></dd>


<dt>yM</dt>
<dd><p>New y vector for recomputing coefficients but 
the values have already been collapsed into replicate group means.</p></dd>


<dt>Y</dt>
<dd><p>raw data Y vector</p></dd>


<dt>x</dt>
<dd><p>raw x matrix of spatial locations  
OR 
In the case of %d*%, y is either a matrix or a vector. As a vector, y, is
interpreted to be the elements of a digaonal matrix.</p></dd>


<dt>weights</dt>
<dd><p>Raw <code>weights</code> vector passed to Krig</p></dd>

<dt>Z</dt>
<dd><p>Raw vector or matrix of additional covariates.</p></dd>


<dt>na.rm</dt>
<dd><p>NA action logical values passed to Krig</p></dd>


<dt>knots</dt>
<dd><p>Raw <code>knots</code> matrix  passed to Krig</p></dd>
 

</dl></div>
    <div id="details">
    <h2>Details</h2>
    

<p>ENGINES:</p>
<p>The engines are the 
code modules that handle the basic linear algebra needed to 
computed the estimated curve or surface coefficients. 
All the engine work on the data that has been reduced to unique 
locations and possibly replicate group means with the weights 
adjusted accordingly. All information needed for the decomposition are 
components in the Krig object passed to these functions.</p>
<p><code>Krig.engine.default</code> finds the decompositions for a Universal
Kriging estimator  by simultaneously diagonalizing the linear system
system for the coefficients of the estimator. The main advantage of this
form is that it is fairly stable numerically, even with ill-conditioned
covariance matrices with lambda &gt; 0. (i.e.  provided there is a "nugget"
or measure measurement error. Also the eigendecomposition allows for
rapid evaluation of the likelihood, GCV and coefficients for new data
vectors under different values of the smoothing parameter, lambda.</p>

<p><code>Krig.engine.knots</code> 
 This code has been omitted from verisions  &gt;=  12.0. See 11.6 too recover this functionality.</p> 
<p><strong>Finds the decompositions in the case that the
covariance is evaluated at arbitrary locations possibly different than
the data locations (called knots). The intent of these decompositions is
to facilitate the evaluation at different values for lambda.  </strong></p>
<p><code>Krig.engine.fixed</code> are specific decomposition based on the Cholesky 
factorization assuming that the smoothing parameter is fixed. This 
is the only case that works in the sparse matrix.
Both knots and the full set of locations can be handled by this case. 
The difference between the "knots" engine above is that only a single value
of lambda is considered in the fixed engine.</p>

<p>OTHER FUNCTIONS:</p>
<p><code>Krig.coef</code> Computes the "c" and "d" coefficients to represent the 
estimated curve. These coefficients are used by the predict functions for 
evaluations. Krig.coef can be used outside of the call to Krig to 
recompute the fit with different Y values and possibly with different
lambda values. If new y values are not passed to this function then the yM
vector in the Krig object is used. The internal function 
<code>Krig.ynew</code> sorts out the logic of what to do and use based on the 
passed arguments.</p>
<p><code>Krig.make.u</code> Computes the "u" vector, a transformation of the collapsed
observations that allows for rapid evaluation of the GCV function and 
prediction. This only makes sense when the decomposition is WBW or DR, i.e. 
an eigen decomposition. If the decompostion is the Cholesky based then this
function returns NA for the u component in the list.</p>
<p><code>Krig.check.xY</code> Checks for removes missing values (NAs).</p>
<p><code>Krig.cor.Y</code> This code has been omitted from verisions  &gt;=  12.0.
See 11.6 too recover this functionality.</p>
<p><code>Krig.transform.xY</code> Finds all replicates and collapse to unique
locations and mean response and pooled variances and weights. These are
the xM, yM and weightsM used in the engines. Also scales the x locations
and the knots according to the transformation.</p>
<p><code>Krig.make.W</code> and <code>Krig.make.Wi</code> These functions create an
off-diagonal weight matrix and its symmetric square root or the inverse
of the weight matrix based on the information passed to Krig.  If
<code>out$nondiag</code> is TRUE W is constructed based on a call to the
passed
function wght.function along with additional arguments.  If this flag
is FALSE then W is just <code>diag(out$weightsM)</code> and the square root
and inverse are computed directly.</p>
<p><code>%d*%</code> Is a simple way to implement efficient diagonal
multiplications.  x%d*%y is interpreted to mean diag(x)%*% y
if x is a vector. If x is a matrix then this becomes the same as the
usual matrix multiplication.</p>
    </div>
    <div id="returned-values">
    <h2>Returned Values</h2>
    

<p>ENGINES:</p>
<p>The returned value is a list with the matrix decompositions and 
other information. These are incorporated into the complete Krig object.</p>
<p>Common to all engines:</p><dl><dt>decomp</dt>
<dd><p>Type of decomposition</p></dd>

   <dt>nt</dt>
<dd><p>dimension of T matrix</p></dd>

   <dt>np</dt>
<dd><p>number of knots</p></dd>


</dl><p><code>Krig.engine.default</code>:</p>
<dl><dt>u</dt>
<dd><p>Transformed data using eigenvectors.</p></dd>

<dt>D</dt>
<dd><p>Eigenvalues</p></dd>

<dt>G</dt>
<dd><p>Reduced and weighted matrix of the eigenvectors</p></dd>

<dt>qr.T</dt>
<dd><p>QR decomposition of fixed regression matrix</p></dd>

<dt>V</dt>
<dd><p>The eigenvectors</p></dd>


</dl><p><code>Krig.engine.fixed</code>:</p>
<dl><dt>d</dt>
<dd><p>estimated coefficients for the fixed part of model</p></dd>

<dt>c</dt>
<dd><p>estimated coefficients for the basis functions derived from the 
                 covariance function.</p></dd>


</dl><p>Using all data locations</p>
<dl><dt>qr.VT</dt>
<dd><p>QR decomposition of the inverse Cholesky factor times the 
T matrix.</p></dd>

<dt>MC</dt>
<dd><p>Cholesky factor</p></dd>


</dl><p>Using knot locations</p><dl><dt>qr.Treg</dt>
<dd><p>QR decomposition of regression matrix modified by the 
estimate of the nonparametric ( or spatial) component.</p></dd>
 
<dt>lambda.fixed</dt>
<dd><p>Value of lambda used in the decompositions</p></dd>


</dl><p>OTHER FUNCTIONS:</p>
<p><code>Krig.coef</code></p><dl><dt>yM</dt>
<dd><p>Y values as replicate group means</p></dd>

<dt>tauHat.rep</dt>
<dd><p>Sample standard deviation of replicates</p></dd>

<dt>tauHat.pure.error</dt>
<dd><p>Same as tauHat.rep</p></dd>

<dt>pure.ss</dt>
<dd><p>Pure error sums of squares based on replicates</p></dd>

<dt>c</dt>
<dd><p>The "c" basis coefficients associated with the covariance
or radial basis functions.</p></dd>

<dt>d</dt>
<dd><p>The "d" regression type coefficients that are from the fixed part of the model
or the linear null space.</p></dd>

<dt>u</dt>
<dd><p>When the default decomposition is used the data vector transformed by the orthogonal matrices. This facilitates evaluating the GCV function 
at different values of the smoothing parameter.</p></dd>


</dl><p><code>Krig.make.W</code></p><dl><dt>W</dt>
<dd><p>The weight matrix</p></dd>

<dt>W2</dt>
<dd><p>Symmetric square root of weight matrix</p></dd>


</dl><p><code>Krig.make.Wi</code></p><dl><dt> Wi</dt>
<dd><p>The inverse weight matrix</p></dd>

<dt>W2i</dt>
<dd><p>Symmetric square root of inverse weight matrix</p></dd>


</dl></div>
    <div id="author">
    <h2>Author</h2>
    <p>Doug Nychka</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="Krig.html">Krig</a></code>, <code><a href="Tps.html">Tps</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="Krig.html">Krig</a></span><span class="op">(</span> <span class="va">ChicagoO3</span><span class="op">$</span><span class="va">x</span>, <span class="va">ChicagoO3</span><span class="op">$</span><span class="va">y</span>, aRange<span class="op">=</span><span class="fl">100</span><span class="op">)</span><span class="op">-&gt;</span> <span class="va">out</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">Krig.engine.default</span><span class="op">(</span> <span class="va">out</span><span class="op">)</span><span class="op">-&gt;</span> <span class="va">stuff</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compare "stuff" to components in out$matrices</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">look1</span><span class="op">&lt;-</span> <span class="fu">Krig.coef</span><span class="op">(</span> <span class="va">out</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">look1</span><span class="op">$</span><span class="va">c</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,] -2.4887193</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,] -5.9442552</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,] -9.4559993</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,] -6.3077137</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,] -1.7111851</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,]  0.3705694</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,] -1.9656335</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,] -1.5278066</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,]  6.4522473</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10,] -1.7351620</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11,]  1.9239144</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [12,] -0.2111423</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13,]  1.5976487</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [14,] -1.5625771</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15,]  2.2762835</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16,]  5.3098945</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17,] -6.8591942</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [18,] 11.2403805</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19,]  2.3703084</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [20,]  8.2281417</span>
<span class="r-in"><span><span class="co"># compare to out$c</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">look2</span><span class="op">&lt;-</span> <span class="fu">Krig.coef</span><span class="op">(</span> <span class="va">out</span>, yM <span class="op">=</span> <span class="va">ChicagoO3</span><span class="op">$</span><span class="va">y</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">look2</span><span class="op">$</span><span class="va">c</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [1,] -2.4887193</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [2,] -5.9442552</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [3,] -9.4559993</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [4,] -6.3077137</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [5,] -1.7111851</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [6,]  0.3705694</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [7,] -1.9656335</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [8,] -1.5278066</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  [9,]  6.4522473</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [10,] -1.7351620</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [11,]  1.9239144</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [12,] -0.2111423</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [13,]  1.5976487</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [14,] -1.5625771</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [15,]  2.2762835</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [16,]  5.3098945</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [17,] -6.8591942</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [18,] 11.2403805</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [19,]  2.3703084</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [20,]  8.2281417</span>
<span class="r-in"><span><span class="co"># better be the same even though we pass as new data!</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Douglas Nychka, Reinhard Furrer, John Paige, Stephan Sain, Florian Gerber, Matthew Iverson.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

