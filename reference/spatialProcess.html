<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Estimates a spatial process model. 
 — spatialProcess • fields</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Estimates a spatial process model. 
 — spatialProcess"><meta property="og:description" content="For a given covariance function  estimates the covariance parameters by maximum   likelihood and then evaluates the 
	spatial model with these estimated parameters. The returned object can be used for spatial prediction, conditional simulation, and profiling the likelihood function. For fixed values of the covariance parameters this process estimate is also known as Kriging.	 
"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">fields</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">14.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Tps.html">Tps usage illustration</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/dnychka/fieldsRPackage/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Estimates a spatial process model. 
<!-- %%  ~~function to do ... ~~ --></h1>
    
    <div class="hidden name"><code>spatialProcess.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>For a given covariance function  estimates the covariance parameters by maximum   likelihood and then evaluates the 
	spatial model with these estimated parameters. The returned object can be used for spatial prediction, conditional simulation, and profiling the likelihood function. For fixed values of the covariance parameters this process estimate is also known as Kriging.</p>	 
<p><!-- %%  ~~ A concise (1-5 lines) description of what the function does. ~~ --></p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">spatialProcess</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>,  weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span>,   Z <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                  mKrig.args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                cov.function <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                    cov.args <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                     parGrid <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                      reltol <span class="op">=</span> <span class="fl">1e-4</span>,</span>
<span>                       na.rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                     verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                        REML <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>            cov.params.start <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                       gridN <span class="op">=</span> <span class="fl">5</span>,</span>
<span>               profileLambda <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>               profileARange <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>               profileGridN  <span class="op">=</span> <span class="fl">15</span>, </span>
<span>                  gridARange <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                  gridLambda <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                 CILevel<span class="op">=</span> <span class="fl">.95</span>,</span>
<span>                  iseed <span class="op">=</span> <span class="fl">303</span>,</span>
<span>                           <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for spatialProcess</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">object</span>,  <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for spatialProcess</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, digits <span class="op">=</span> <span class="fl">4</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for spatialProcessSummary</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">x</span>, digits <span class="op">=</span> <span class="fl">4</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for spatialProcess</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">x</span>, digits <span class="op">=</span> <span class="fl">4</span>, which <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span>                           </span>
<span><span class="fu">spatialProcessSetDefaults</span><span class="op">(</span><span class="va">x</span>, <span class="va">cov.function</span>, <span class="va">cov.args</span>, <span class="va">cov.params.start</span>, <span class="va">parGrid</span>,</span>
<span>                 <span class="va">mKrig.args</span>, extraArgs <span class="op">=</span> <span class="cn">NULL</span>, gridN <span class="op">=</span> <span class="fl">5</span>, verbose <span class="op">=</span></span>
<span>                 <span class="cn">FALSE</span><span class="op">)</span></span>
<span>    </span>
<span><span class="fu">confidenceIntervalMLE</span><span class="op">(</span> <span class="va">obj</span>, <span class="va">CILevel</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">profileMLE</span> <span class="op">(</span><span class="va">obj</span>, <span class="va">parName</span>, parGrid<span class="op">=</span><span class="cn">NULL</span>, gridN<span class="op">=</span><span class="fl">15</span>,</span>
<span>                       cov.params.start<span class="op">=</span><span class="cn">NULL</span>, GCV<span class="op">=</span><span class="cn">FALSE</span>, REML<span class="op">=</span><span class="cn">FALSE</span>,</span>
<span>                       verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>x</dt>
<dd><p>Observation locations</p></dd>


<dt>y</dt>
<dd><p>Observation values</p></dd>


<dt>weights</dt>
<dd><p>Weights for the error term (nugget) in units of
reciprocal variance.</p></dd>


<dt>Z</dt>
<dd><p>A matrix of extra covariates for the fixed part of spatial
model.
E.g. elevation for fitting climate data over space.</p></dd>


<dt>CILevel</dt>
<dd><p>Confidence level for intervals for the estimated
parameters.</p></dd>


 <dt>cov.args</dt>
<dd><p>A list specifying parameters and other components 
 of the
 covariance function. Default is not extra arguments required.]
 (But see the next item.).</p></dd>

 
<dt>cov.function</dt>
<dd><p>A character string giving the name of the 
covariance function
  	 for the spatial component.
  	 If NULL, the default,  this is  filled in as 
  	 <code>stationary.cov</code> and then
  	 if <code>cov.args</code> is also NULL this is filled in as 
  	 <code> list(Covariance = "Matern", smoothness = 1.0)</code> by the spatialProcessSetDefaults 
  	 function.</p></dd>

  	 
<dt>cov.params.start</dt>
<dd><p>A list where the names are  parameter names
that appear in the covariance function. The values of each component
are assumed to be the starting values when optimizing to find MLEs. If
lambda does not appear
as additional
argument when calling spatialProcess it is added internally to this
list with the starting value .5.</p></dd>


 <dt>digits</dt>
<dd><p>Number of significant digits in printed summary</p></dd>


<dt>extraArgs</dt>
<dd><p>Extra arguments passed using the ... device in R.
Typically these are extra covariance parameters specified in
<code>spatialProcess</code> and then passed to
<code>spatialProcessSetDefaults</code></p></dd>

 
<dt>GCV</dt>
<dd><p>A future argument not currently implemented. If TRUE will
find parameters by minimizing an approximate generalized 
cross-validation function.</p></dd>

 
 <dt>gridARange</dt>
<dd><p>A grid for profiling  over the range parameter. If
 omitted, default is  based on a grid of profileGridN points centered at the
 MLE.</p></dd>

<dt>gridLambda</dt>
<dd><p>A grid for profiling over lambda.</p></dd>


 <dt>gridN</dt>
<dd><p>Number of grid points for intital fgrid search to find starting values.</p></dd>

 
  	
<dt>na.rm</dt>
<dd><p>If TRUE NAs are removed from the data.</p></dd>


<dt>mKrig.args</dt>
<dd><p>Arguments as a list passed to the mKrig function. For example use
mKrig.args=list( m = 1) to set the fixed part of the model to just a constant function , 
or 0 to omit any fixed part. (The default is m=2 a linear function, which is recommend for most data analysis.) See <code><a href="mKrig.html">mKrig</a></code> for more details.</p></dd>


<dt>obj</dt>
<dd><p>A spatialProcess object returned from the spatialProcess function.</p></dd>

<dt>object</dt>
<dd><p>See <code>obj</code>.</p></dd>


<dt>parGrid</dt>
<dd><p>A data frame with the values of covariance parameters
to use as an initial grid search for starting values.</p></dd>


<dt>parName</dt>
<dd><p>Text string that is the name of the parameter to 
 profile .</p></dd>

 
 <dt>profileARange</dt>
<dd><p>If TRUE profile likelihood on aRange. Default is
TRUE if aRange is omitted.</p></dd>


<dt>profileGridN</dt>
<dd><p>Number of grid points to use for profiling.</p></dd>


<dt>profileLambda</dt>
<dd><p>If TRUE profile likelihood on lambda. This takes
extra time and is not necessary so the default is FALSE.</p></dd>


 <dt>reltol</dt>
<dd><p>Relative tolerance used in optim for convergence.</p></dd>

 
 <dt>REML</dt>
<dd><p>If TRUE the parameters are found by restricted maximum likelihood.</p></dd>

 
 <dt>verbose</dt>
<dd><p>If TRUE print out intermediate information for debugging.</p></dd>

 
 <dt>iseed</dt>
<dd><p>A seed to fix the random number stream used to compute the effective degrees of freedom using the random trace method. Setting this seed will not affect any random numnber generation outside this function.</p></dd>


  <dt>...</dt>
<dd><p>Any other arguments that will be passed to the <code>mKrig</code> function and interpreted
  	as additional arguments to the covariance function.  This is a lazy way of specifying these. 
  	E.g. <code>aRange =.1</code> will set the covariance argument aRange to .1.</p></dd>

  
  <dt>which</dt>
<dd><p>The vector 1:4 or any subset of 1:4, giving the plots
  to draw. See the description of these plots below.</p></dd>


</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>This function makes many choices for the user in terms of defaults and it is 
	important to be aware of these. 
	The spatial model is</p>	
<p>Y.k= P(x.k) + Z(x.k)%*%beta2 + g(x.k) + e.k</p>
<p>where ".k" means subscripted by k, Y.k is the dependent variable
observed at location x.k. P is a low degree polynomial (default is a
linear function in the spatial coordinates, m=2 ) and Z is a
matrix of covariates (optional) that
enter as a linear model the fixed part. g is a mean zero,
Gaussian stochastic process with a marginal variance of sigma and a
scale (or range) parameter, aRange. The measurement errors, e.k, are
assumed to be uncorrelated, normally distributed with mean zero and
standard deviation tau. If weights are supplied then the variance of e is assumed to be
<code>tau^2/ weights</code>. The polynomial if specified and extra covariates define
the fixed part of this spatial model and the coefficients are found by
generalized least squares (GLS).</p>
<p>Perhaps the most important aspect of this function is that
 	the range parameter (aRange), nugget (tau**2) and process variance (sigma) parameters
 	for the covariance are estimated by maximum
 	likelihood and this is the model that is then  used for spatial
 	prediction. Geostatistics usually refers to tau^2 + sigma^2 as the 
 	"sill" and often these parameters are estimated by variogram fitting rather
 	than maximum likelihood. To be consistent with spline models and to focus
 	on the key part of model we reparametrize as lambda= tau**2/
 	sigma^2 and sigma. Thinking about h as the spatial signal and e as the noise  1/lambda
 	can be interpreted  as the "signal to noise " ratio in this spatial
 	context.(See also the comparison with fitting the geoR model in the
  examples section.)</p> 	
<p>For an isotropic covariance function, the likelihood and the cross-validation function
 	can be concentrated to only depend on lambda and aRange and so
 	in reporting the optimization of these two criterion we focus
 	on this form of the parameters.  Once lambda and aRange are
 	found, the MLE for sigma has a closed form and of course then
 	tau is then determined from lambda and sigma. The estimates of the coefficients 
 	for the fixed part of the model, determined by GLS, will also be the MLEs.</p> 	
<p>Often the lambda
 	parameter is difficult to interpret when covariates and a
 	linear function of the coordinates is included and also when
 	the range becomes large relative to the size of the spatial
 	domain. For this reason it is convenient to report the
 	effective degrees of freedom (also referred to trA in R code and
 	the output summaries) associated with the predicted
 	surface or curve. This measure has a one-to-one relationship
 	with lambda and is easier to interpret. For example an eff
 	degrees of freedom that is very small suggests that the
 	surface is well represented by a low order
 	polynomial. Degrees of freedom close to the number of
 	locations indicates a surface that is close to interpolating
 	the observations and suggests a small or zero value for the
 	nugget variance.</p> 	
<p>The default covariance model is assumed to follow a Matern
 	 with smoothness set to 1.0.  This is implemented using the
 	 <code>stationary.cov</code> covariance that can take a argument for
 	 the form of the covariance, a sill and range parameters and
 	 possibly additional parameter might control the shape.</p> 	 
<p>See the example below how to switch to another model. (Note
 	 that the exponential is also part of the Matern family with
 	 smoothness set to .5. )</p>  	
<p>The parameter estimation is done by <code>MLESpatialProcess</code>
 	and the returned list from this function is added to the Krig
 	output object that is returned by this function. The estimate
 	is a version of maximum likelihood where the observations are
 	transformed to remove the fixed linear part of the model.  If
 	the user just wants to fix the range parameter aRange then
 	<code>Krig</code> can be used.</p> 	
<p>NOTE: The defaults for the <code>optim</code> function used in MLESpatialProcess are:</p> 	
<p></p><div class="sourceCode"><pre><code><span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"BFGS"</span>, </span>
<span>       control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fnscale <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>                      ndeps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1.1</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">cov.params.start</span><span class="op">)</span><span class="op">+</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>                     reltol <span class="op">=</span> <span class="va">reltol</span>,</span>
<span>                      maxit <span class="op">=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
                                     

<p>There is always a hazard in providing a simple to use method that
makes many default choices for the spatial model. As in any analysis
be aware of these choices and try alternative models and parameter
values to assess the robustness of your conclusions. Also examine the
residuals to check the adequacy of the fit. See the examples below for
some help in how to do this easily in fields. Also see quilt.plot to
get an quick plot of a spatial field  to discern obvious spatial patterns.</p>

<p><strong>summary</strong> method forms a list of class <code>spatialProcessSummary</code> that has a
subset of information from the output object and also creates a table of the estimates
of the linear parameters in the fixed part of the model.
With replicated fields there is an option to estimate different linear parameters for each field
( <code> collapseFixedEffect = FALSE </code> ) and in this case a table is not created because
there is more than one estimate. See (<code>Omega</code> and <code>fixedEffectsCov</code>) in the
<code>mKrig</code> object to build the standard errors.</p>
<p><strong>plot</strong> method  provides potentially  four diagnostic plots of the fit.Use the <code>which</code>
to pick and choose among them 
or use <code>set.panel</code> to see  them all.
The third and fourth plots, however, are only available if the profile computations been done. 
If lambda is profiled (<code>lambdaProfile</code> is not
<code>NULL</code> ) the third plot is the profile log
likelihood for lambda and with the GCV function on a
second vertical scale.
This is based on the grid evaluations in the component 
<code> lambdaProfile\$MLEProfileLambda</code> .
The fourth
plot is a profile log likelihood trace for aRange
based on <code> aRangeProfile\$MLEProfileLambda</code>.</p>

<p><strong>print</strong> method prints the  <code>spatialProcessSummary</code> object of the fit, adding
some details and explanations.</p>
<p><strong>spatialProcessSetDefaults</strong> This is a useful way to fill in defaults for the function in one place. The main choices are choosing the Matern family, smoothness and a default fixed model (aka spatial drift). The grids for profiling are also created if they have not been supplied.</p>
<p><!-- %%  ~~ If necessary, more details than the description above ~~ --></p>
    </div>
    <div id="value">
    <h2>Value</h2>
    

<p>An object of classes <code>mKrig</code> and  <code>SpatialProcess</code>. The difference
	from mKrig are some extra  components. The more useful ones are listed below</p>
	
	
<p></p>
<p><strong>MLESummary</strong> A named array that has the fixed and estimated parameters along with likelihood values and some optim info.</p>
<p></p>
<p><strong>profileSummaryLambda and profileSummaryARange</strong> The output list from 
  mKrigMLEGrid for searching over over a grid of lambda and aRange.</p>
<p></p>
<p><strong>CITable</strong> Approximate confidence intervals based on the inverse hessian of the log likelihood function.</p>
<p></p>
<p><strong>MLEInfo</strong> A list that has a full documentation of the maximization including all parameters  and likelihood values that were tried by the optim function.</p>
<p></p>
<p><strong>InitialGridSearch</strong> Results from initial grid search to get good starting values for lambda and/or aRange.</p>
        	

    </div>
    <div id="author">
    <h2>Author</h2>
    <p>Doug Nychka<!-- %%  ~~who you are~~ --></p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><a href="Tps.html">Tps</a>,   <a href="mKrigMLE.html">mKrigMLEGrid</a>,
<a href="mKrigMLE.html">mKrigMLEJoint</a>,  <a href="plot.Krig.html">plot.Krig</a>,  <a href="mKrig.html">predict.mKrig</a>,
<a href="predictSE.Krig.html">predictSE.mKrig</a></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span> <span class="va">ozone2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># x is a two column matrix where each row is a location in lon/lat </span></span></span>
<span class="r-in"><span><span class="co"># coordinates</span></span></span>
<span class="r-in"><span>  <span class="va">x</span><span class="op">&lt;-</span> <span class="va">ozone2</span><span class="op">$</span><span class="va">lon.lat</span></span></span>
<span class="r-in"><span><span class="co"># y is a vector of ozone measurements at day 16. Note some missing values. </span></span></span>
<span class="r-in"><span>  <span class="va">y</span><span class="op">&lt;-</span> <span class="va">ozone2</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fl">16</span>,<span class="op">]</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co"># artifically reduce size of data for a quick example to pass CRAN ...</span></span></span>
<span class="r-in"><span>  <span class="va">x</span><span class="op">&lt;-</span> <span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">75</span>,<span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">y</span><span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">75</span><span class="op">]</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co"># lots of default choices  made here -- see gridN to increase </span></span></span>
<span class="r-in"><span><span class="co"># the number of points in grid searches for MLEs</span></span></span>
<span class="r-in"><span><span class="co"># without specifying  lambda or aRange both are found in a robust </span></span></span>
<span class="r-in"><span><span class="co"># way uses grid searches </span></span></span>
<span class="r-in"><span><span class="co"># profiling over lambda and aRange  is not reuqired but completes the full </span></span></span>
<span class="r-in"><span><span class="co"># example.  Omit this for a faster computation.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">obj</span><span class="op">&lt;-</span> <span class="fu">spatialProcess</span><span class="op">(</span> <span class="va">x</span>, <span class="va">y</span>, profileLambda<span class="op">=</span><span class="cn">TRUE</span>, profileARange<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co"># summary of model</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span> <span class="va">obj</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> CALL:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> spatialProcess(x = x, y = y, profileLambda = TRUE, profileARange = TRUE)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  SUMMARY OF MODEL FIT:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                                                              </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Number of Observations:                    74               </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Degree of polynomial in fixed part:        1                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Total number of parameters in fixed part:  3                </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  sigma Process stan. dev:                   21.27            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  tau  Nugget stan. dev:                     10.22            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  lambda   tau^2/sigma^2:                    0.2311           </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  aRange parameter (in units of distance):   1.115            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Approx.  degrees of freedom for curve      28.02            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Standard Error of df estimate:          1.312            </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  log Likelihood:                            -305.056427482396</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  log Likelihood REML:                       -309.414430504448</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  ESTIMATED COEFFICIENTS FOR FIXED PART:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    estimate      SE  pValue</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> d1  345.800 272.500 0.20440</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> d2    7.027   3.044 0.02099</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> d3    8.484   4.636 0.06723</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  COVARIANCE MODEL: stationary.cov</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Covariance function:  Matern</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    Non-default covariance arguments and their values </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Covariance :</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Matern"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> smoothness :</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> aRange :</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1.115425</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> onlyUpper :</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] FALSE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> distMat :</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] NA</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Nonzero entries in covariance matrix  5476</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> SUMMARY FROM Max. Likelihood ESTIMATION:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Parameters found from optim: </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    lambda    aRange </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 0.2311332 1.1154248 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Approx. confidence intervals for MLE(s) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          lower95%  upper95%</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lambda 0.08870229 0.6022682</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> aRange 0.48240121 2.5791239</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  Note: MLEs for  tau and sigma found analytically from lambda</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Summary from estimation:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> lnProfileLike.FULL lnProfileREML.FULL        lnLike.FULL        lnREML.FULL </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       -305.0564275       -309.4144305                 NA                 NA </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             lambda                tau             sigma2             aRange </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          0.2311332         10.2249266        452.3327549          1.1154248 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             eff.df                GCV </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         28.0164893        174.0036602 </span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co"># diagnostic plots</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="set.panel.html">set.panel</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> plot window will lay out plots in a 2 by 2 matrix </span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">obj</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="spatialProcess-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co"># plot 1 data vs. predicted values</span></span></span>
<span class="r-in"><span><span class="co"># plot 2 residuals vs. predicted</span></span></span>
<span class="r-in"><span><span class="co"># plot 3 criteria to select the smoothing</span></span></span>
<span class="r-in"><span><span class="co">#        parameter lambda = tau^2 / sigma</span></span></span>
<span class="r-in"><span><span class="co">#        the x axis has log10 lambda</span></span></span>
<span class="r-in"><span><span class="co">#        Note that here the GCV function is minimized</span></span></span>
<span class="r-in"><span><span class="co">#        while the log profile likelihood  is maximzed. </span></span></span>
<span class="r-in"><span><span class="co"># plot 4 the log profile likelihood used to </span></span></span>
<span class="r-in"><span><span class="co">#        determine range parameter aRange. </span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="set.panel.html">set.panel</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> plot window will lay out plots in a 1 by 1 matrix </span>
<span class="r-in"><span><span class="co"># predictions on a grid </span></span></span>
<span class="r-in"><span><span class="fu"><a href="fields-internal.html">surface</a></span><span class="op">(</span> <span class="va">obj</span>, xlab<span class="op">=</span><span class="st">"longitude"</span>, ylab<span class="op">=</span><span class="st">"latitude"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="US.html">US</a></span><span class="op">(</span> add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"grey"</span>, lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Predicted ozone (in PPB)  June 18, 1987 "</span><span class="op">)</span>  </span></span>
<span class="r-plt img"><img src="spatialProcess-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span><span class="co">#(see also predictSurface for more control on evaluation grid, predicting</span></span></span>
<span class="r-in"><span><span class="co"># outside convex hull of the data. and plotting)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># prediction standard errors, note two steps now to generate</span></span></span>
<span class="r-in"><span><span class="co"># and then plot surface</span></span></span>
<span class="r-in"><span><span class="va">look</span><span class="op">&lt;-</span> <span class="fu"><a href="predictSurface.html">predictSurfaceSE</a></span><span class="op">(</span> <span class="va">obj</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="fields-internal.html">surface</a></span><span class="op">(</span> <span class="va">look</span>, xlab<span class="op">=</span><span class="st">"longitude"</span>, ylab<span class="op">=</span><span class="st">"latitude"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span> <span class="va">x</span>, col<span class="op">=</span><span class="st">"magenta"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"prediction standard errors (PPB)"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="spatialProcess-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># here  is a sanity check -- call spatialProcess with the MLEs found</span></span></span>
<span class="r-in"><span><span class="co"># above, better get the same predictions!</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">objTest</span><span class="op">&lt;-</span> <span class="fu">spatialProcess</span><span class="op">(</span> <span class="va">x</span>, <span class="va">y</span>,</span></span>
<span class="r-in"><span>                          lambda<span class="op">=</span><span class="va">obj</span><span class="op">$</span><span class="va">MLESummary</span><span class="op">[</span><span class="st">"lambda"</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>                          aRange<span class="op">=</span><span class="va">obj</span><span class="op">$</span><span class="va">MLESummary</span><span class="op">[</span><span class="st">"aRange"</span><span class="op">]</span></span></span>
<span class="r-in"><span>                          <span class="op">)</span></span></span>
<span class="r-in"><span>                          </span></span>
<span class="r-in"><span><span class="fu"><a href="fields.tests.html">test.for.zero</a></span><span class="op">(</span><span class="va">objTest</span><span class="op">$</span><span class="va">fitted.values</span>, <span class="va">obj</span><span class="op">$</span><span class="va">fitted.values</span>, </span></span>
<span class="r-in"><span>            tag<span class="op">=</span><span class="st">"sanity check"</span> <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Testing:  sanity check</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> PASSED test at tolerance  1e-08</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">##################################</span></span></span>
<span class="r-in"><span><span class="co"># working with covariates and filling in missing station data</span></span></span>
<span class="r-in"><span><span class="co"># using an ensemble method</span></span></span>
<span class="r-in"><span><span class="co"># see the example under  help(sim.spatialProcess) to see how to </span></span></span>
<span class="r-in"><span><span class="co"># handle a conditional simulation on a grid of predictions with </span></span></span>
<span class="r-in"><span><span class="co"># covariates. </span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">COmonthlyMet</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">fit1E</span><span class="op">&lt;-</span> <span class="fu">spatialProcess</span><span class="op">(</span><span class="va">CO.loc</span>,<span class="va">CO.tmin.MAM.climate</span>, Z<span class="op">=</span><span class="va">CO.elev</span>, </span></span>
<span class="r-in"><span>                  profileLambda<span class="op">=</span><span class="cn">TRUE</span>, profileARange<span class="op">=</span><span class="cn">TRUE</span></span></span>
<span class="r-in"><span>             <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="set.panel.html">set.panel</a></span><span class="op">(</span> <span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span>                             </span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">fit1E</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span>  <span class="fu"><a href="set.panel.html">set.panel</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co"># plots of the fitted surface and surface of prediction standard errors   </span></span></span>
<span class="r-in"><span>  <span class="va">out.p</span><span class="op">&lt;-</span><span class="fu"><a href="predictSurface.html">predictSurface</a></span><span class="op">(</span> <span class="va">fit1E</span>,<span class="va">CO.Grid</span>,</span></span>
<span class="r-in"><span>                             ZGrid<span class="op">=</span> <span class="va">CO.elevGrid</span>, extrap<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="imagePlot.html">imagePlot</a></span><span class="op">(</span> <span class="va">out.p</span>, col<span class="op">=</span><span class="fu"><a href="tim.colors.html">larry.colors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="US.html">US</a></span><span class="op">(</span>add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/contour.html" class="external-link">contour</a></span><span class="op">(</span> <span class="va">CO.elevGrid</span>, add<span class="op">=</span><span class="cn">TRUE</span>, levels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1000</span>,<span class="fl">3000</span>,,<span class="fl">5</span><span class="op">)</span>, col<span class="op">=</span><span class="st">"black"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Average Spring daily min. temp in CO"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">out.p2</span><span class="op">&lt;-</span><span class="fu"><a href="predictSurface.html">predictSurfaceSE</a></span><span class="op">(</span> <span class="va">fit1E</span>,<span class="va">CO.Grid</span>,</span></span>
<span class="r-in"><span>                         ZGrid<span class="op">=</span> <span class="va">CO.elevGrid</span>,</span></span>
<span class="r-in"><span>                         extrap<span class="op">=</span><span class="cn">TRUE</span>, verbose<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> </span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="imagePlot.html">imagePlot</a></span><span class="op">(</span> <span class="va">out.p2</span>, col<span class="op">=</span><span class="fu"><a href="tim.colors.html">larry.colors</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="US.html">US</a></span><span class="op">(</span>add<span class="op">=</span><span class="cn">TRUE</span>, col<span class="op">=</span><span class="st">"grey"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span> <span class="va">fit1E</span><span class="op">$</span><span class="va">x</span>, pch<span class="op">=</span><span class="st">"."</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Prediction SE"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="set.panel.html">set.panel</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">###################################</span></span></span>
<span class="r-in"><span><span class="co"># conditional simulation </span></span></span>
<span class="r-in"><span><span class="co">###################################</span></span></span>
<span class="r-in"><span><span class="co">#  first a small application  at missing data</span></span></span>
<span class="r-in"><span>  <span class="va">notThere</span><span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">CO.tmin.MAM.climate</span> <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">xp</span> <span class="op">&lt;-</span> <span class="va">CO.loc</span><span class="op">[</span><span class="va">notThere</span>,<span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">Zp</span> <span class="op">&lt;-</span> <span class="va">CO.elev</span><span class="op">[</span><span class="va">notThere</span><span class="op">]</span></span></span>
<span class="r-in"><span>  <span class="va">infill</span><span class="op">&lt;-</span> <span class="fu"><a href="sim.Krig.html">sim.spatialProcess</a></span><span class="op">(</span> <span class="va">fit1E</span>, xp<span class="op">=</span><span class="va">xp</span>,</span></span>
<span class="r-in"><span>                      Z<span class="op">=</span> <span class="va">Zp</span>, M<span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span> <span class="va">infill</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#  </span></span></span>
<span class="r-in"><span><span class="co"># interpretation is that these infilled values are all equally plausible </span></span></span>
<span class="r-in"><span><span class="co"># given the observations and also given the estimated covariance model</span></span></span>
<span class="r-in"><span><span class="co">#  </span></span></span>
<span class="r-in"><span><span class="co"># EXTRA CREDIT:  standardize the infilled values to have</span></span></span>
<span class="r-in"><span><span class="co"># conditional mean and variance from the exact computations</span></span></span>
<span class="r-in"><span><span class="co">#  e.g. predict( fit1E, xp=CO.loc[!good,],  Z= CO.elev[!good])</span></span></span>
<span class="r-in"><span><span class="co">#  and  predictSE(fit1E, xp=CO.loc[!good,],  Z= CO.elev[!good])  </span></span></span>
<span class="r-in"><span><span class="co"># with these standardization one would still preserve the correlations</span></span></span>
<span class="r-in"><span><span class="co"># among the infilled values that is also important for considering them as a</span></span></span>
<span class="r-in"><span><span class="co"># multivariate prediction.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># conditional simulation on a grid but not using the covariate of elevation</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span> <span class="va">fit2</span><span class="op">&lt;-</span> <span class="fu">spatialProcess</span><span class="op">(</span><span class="va">CO.loc</span>,<span class="va">CO.tmin.MAM.climate</span>,</span></span>
<span class="r-in"><span>                        gridARange<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="fl">2.0</span>, length.out<span class="op">=</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span>                       <span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># note larger range parameter</span></span></span>
<span class="r-in"><span><span class="co"># create 2500 grid points using a handy fields function</span></span></span>
<span class="r-in"><span>  <span class="va">gridList</span> <span class="op">&lt;-</span> <span class="fu"><a href="grid.list.html">fields.x.to.grid</a></span><span class="op">(</span> <span class="va">fit2</span><span class="op">$</span><span class="va">x</span>, nx<span class="op">=</span><span class="fl">50</span>,ny<span class="op">=</span><span class="fl">50</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">xGrid</span><span class="op">&lt;-</span> <span class="fu"><a href="grid.list.html">make.surface.grid</a></span><span class="op">(</span> <span class="va">gridList</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">ensemble</span><span class="op">&lt;-</span> <span class="fu"><a href="sim.Krig.html">sim.spatialProcess</a></span><span class="op">(</span> <span class="va">fit2</span>, xp<span class="op">=</span><span class="va">xGrid</span>, M <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># this is an "n^3" computation so increasing the grid size </span></span></span>
<span class="r-in"><span><span class="co"># can slow things down for computation </span></span></span>
<span class="r-in"><span><span class="co"># The 6 ensemble members </span></span></span>
<span class="r-in"><span>   <span class="fu"><a href="set.panel.html">set.panel</a></span><span class="op">(</span> <span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="kw">for</span><span class="op">(</span> <span class="va">k</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span><span class="op">{</span></span></span>
<span class="r-in"><span>    <span class="fu"><a href="imagePlot.html">imagePlot</a></span><span class="op">(</span> <span class="fu"><a href="as.surface.html">as.surface</a></span><span class="op">(</span> <span class="va">xGrid</span>, <span class="va">ensemble</span><span class="op">[</span>,<span class="va">k</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>   <span class="op">}</span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="set.panel.html">set.panel</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## changing the covariance model.</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ozone2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="va">x</span><span class="op">&lt;-</span> <span class="va">ozone2</span><span class="op">$</span><span class="va">lon.lat</span></span></span>
<span class="r-in"><span>  <span class="va">y</span><span class="op">&lt;-</span> <span class="va">ozone2</span><span class="op">$</span><span class="va">y</span><span class="op">[</span><span class="fl">16</span>,<span class="op">]</span></span></span>
<span class="r-in"><span>  </span></span>
<span class="r-in"><span><span class="co"># a comparison to using an exponential and Wendland covariance function</span></span></span>
<span class="r-in"><span><span class="co"># and great circle distance -- just to make range easier to interpret.</span></span></span>
<span class="r-in"><span>  <span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu">spatialProcess</span><span class="op">(</span> <span class="va">x</span>, <span class="va">y</span>,</span></span>
<span class="r-in"><span>                              Distance <span class="op">=</span> <span class="st">"rdist.earth"</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">obj2</span><span class="op">&lt;-</span> <span class="fu">spatialProcess</span><span class="op">(</span> <span class="va">x</span>, <span class="va">y</span>,</span></span>
<span class="r-in"><span>          cov.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Covariance <span class="op">=</span> <span class="st">"Exponential"</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>                              Distance <span class="op">=</span> <span class="st">"rdist.earth"</span> <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">obj3</span><span class="op">&lt;-</span> <span class="fu">spatialProcess</span><span class="op">(</span> <span class="va">x</span>, <span class="va">y</span>,</span></span>
<span class="r-in"><span>          cov.args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>Covariance <span class="op">=</span> <span class="st">"Wendland"</span>,</span></span>
<span class="r-in"><span>                          dimension  <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>                                   k <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                            Distance <span class="op">=</span> <span class="st">"rdist.earth"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># obj2 could be also be fit using the argument:</span></span></span>
<span class="r-in"><span><span class="co">#   cov.args = list(Covariance = "Matern", smoothness=.5)</span></span></span>
<span class="r-in"><span><span class="co">#                            </span></span></span>
<span class="r-in"><span><span class="co"># Note very different range parameters - BTW these are in miles</span></span></span>
<span class="r-in"><span><span class="co"># but similar nugget variances. </span></span></span>
<span class="r-in"><span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span> Whittle<span class="op">=</span> <span class="va">obj</span><span class="op">$</span><span class="va">summary</span>,</span></span>
<span class="r-in"><span> Exp<span class="op">=</span> <span class="va">obj2</span><span class="op">$</span><span class="va">summary</span>,</span></span>
<span class="r-in"><span>Wendland<span class="op">=</span> <span class="va">obj3</span><span class="op">$</span><span class="va">summary</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># since the exponential is Matern with smoothness == .5 the first two</span></span></span>
<span class="r-in"><span><span class="co"># fits can be compared in terms of their likelihoods</span></span></span>
<span class="r-in"><span><span class="co"># the ln likelihood   value is slightly higher for obj verses obj2 (-613.9 &gt;  -614.9)</span></span></span>
<span class="r-in"><span><span class="co"># these are the _negative_ log  likelihoods so suggests a preference for the</span></span></span>
<span class="r-in"><span><span class="co"># smoothness = 1.0 (Whittle)  model </span></span></span>
<span class="r-in"><span><span class="co"># </span></span></span>
<span class="r-in"><span><span class="co"># does it really matter in terms of spatial prediction?</span></span></span>
<span class="r-in"><span><span class="fu"><a href="set.panel.html">set.panel</a></span><span class="op">(</span> <span class="fl">3</span>,<span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="fields-internal.html">surface</a></span><span class="op">(</span> <span class="va">obj</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="US.html">US</a></span><span class="op">(</span> add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Matern sm= 1.0"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="fields-internal.html">surface</a></span><span class="op">(</span> <span class="va">obj2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="US.html">US</a></span><span class="op">(</span> add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Matern sm= .5"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="fields-internal.html">surface</a></span><span class="op">(</span> <span class="va">obj3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="US.html">US</a></span><span class="op">(</span> add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Wendland k =2"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># prediction standard errors</span></span></span>
<span class="r-in"><span><span class="co"># these take a while because prediction errors are based </span></span></span>
<span class="r-in"><span><span class="co"># directly on the Kriging weight matrix</span></span></span>
<span class="r-in"><span><span class="co"># see mKrig for an alternative.</span></span></span>
<span class="r-in"><span><span class="fu"><a href="set.panel.html">set.panel</a></span><span class="op">(</span> <span class="fl">2</span>,<span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">out.p</span><span class="op">&lt;-</span> <span class="fu"><a href="predictSurface.html">predictSurfaceSE</a></span><span class="op">(</span> <span class="va">obj</span>, nx<span class="op">=</span><span class="fl">40</span>,ny<span class="op">=</span><span class="fl">40</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="fields-internal.html">surface</a></span><span class="op">(</span> <span class="va">out.p</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="US.html">US</a></span><span class="op">(</span> add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Matern sm= 1.0"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span> <span class="va">x</span>, col<span class="op">=</span><span class="st">"magenta"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">#</span></span></span>
<span class="r-in"><span><span class="va">out.p</span><span class="op">&lt;-</span> <span class="fu"><a href="predictSurface.html">predictSurfaceSE</a></span><span class="op">(</span> <span class="va">obj</span>, nx<span class="op">=</span><span class="fl">40</span>,ny<span class="op">=</span><span class="fl">40</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="fields-internal.html">surface</a></span><span class="op">(</span> <span class="va">out.p</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="US.html">US</a></span><span class="op">(</span> add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span> <span class="va">x</span>, col<span class="op">=</span><span class="st">"magenta"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Matern sm= .5"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="set.panel.html">set.panel</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Douglas Nychka, Reinhard Furrer, John Paige, Stephan Sain, Florian Gerber, Matthew Iverson.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

